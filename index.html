<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-JURNAL KELAS - TP. 2025/2026</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        .gradient-primary {
            background: linear-gradient(135deg, #4F46E5 0%, #06B6D4 50%, #10B981 100%);
        }
        
        .gradient-secondary {
            background: linear-gradient(135deg, #EC4899 0%, #F97316 100%);
        }
        
        .gradient-success {
            background: linear-gradient(135deg, #10B981 0%, #06B6D4 100%);
        }
        
        .gradient-warning {
            background: linear-gradient(135deg, #F59E0B 0%, #EAB308 100%);
        }
        
        .header-modern {
            background: linear-gradient(135deg, #4F46E5 0%, #06B6D4 50%, #10B981 100%);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(79, 70, 229, 0.15);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header-logo {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .header-logo:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 12px 35px rgba(79, 70, 229, 0.3);
        }
        
        .header-title {
            background: linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .nav-item {
            position: relative;
            padding: 12px 20px;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }
        
        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }
        
        .nav-item:hover::before {
            left: 100%;
        }
        
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.1);
        }
        
        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
        }
        
        .action-button {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .action-button:hover::before {
            left: 100%;
        }
        
        .action-button:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .mobile-menu-modern {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            margin-top: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .card-modern {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-modern:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .btn-modern {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-modern:hover::before {
            left: 100%;
        }
        
        .btn-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .loading-modern {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .nav-modern {
            position: relative;
            transition: all 0.2s ease;
        }
        
        .nav-modern.active {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
        }
        
        .stats-modern {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 1px solid rgba(102, 126, 234, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .stats-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .table-modern {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
        }
        
        .table-modern thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .table-modern tbody tr:hover {
            background: rgba(102, 126, 234, 0.05);
            transform: scale(1.01);
            transition: all 0.2s ease;
        }
        
        .filter-modern {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .notification.info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-present {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .status-absent {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .status-permission {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .status-sick {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }
        
        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
        }
        
        .floating-action:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }
        
        .dark-mode {
            background: #0f172a;
            color: #e2e8f0;
        }
        
        .dark-mode .card-modern {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .dark-mode .filter-modern {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(102, 126, 234, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50"><!-- Header Modern -->
  <header class="header-modern sticky top-0 z-50">
   <div class="max-w-7xl mx-auto px-3 sm:px-4 lg:px-6 xl:px-8"><!-- Main Header Row -->
    <div class="flex justify-between items-center py-3 sm:py-4 lg:py-5"><!-- Logo & Title Section -->
     <div class="flex items-center space-x-2 sm:space-x-3 lg:space-x-5 min-w-0 flex-1">
      <div class="header-logo w-10 h-10 sm:w-12 sm:h-12 lg:w-14 lg:h-14 rounded-xl lg:rounded-2xl flex items-center justify-center flex-shrink-0">
       <svg class="w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 text-indigo-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
       </svg>
      </div>
      <div class="min-w-0 flex-1">
       <h1 id="site-title" class="header-title text-lg sm:text-xl md:text-2xl lg:text-3xl xl:text-4xl font-bold truncate">E-JURNAL KELAS</h1>
       <p id="school-name" class="text-white/80 text-xs sm:text-sm lg:text-base font-medium tracking-wide truncate">SMAN 1 Singkep Selatan</p>
      </div>
     </div><!-- Desktop Navigation - Hidden on smaller screens -->
     <nav class="hidden xl:flex items-center space-x-1 2xl:space-x-2 mx-4"><a href="#" class="nav-item active text-white font-semibold text-sm 2xl:text-base" onclick="showSection('dashboard')"> <span class="flex items-center space-x-1.5 2xl:space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v6H8V5z"></path>
        </svg><span class="hidden 2xl:inline">Dashboard</span> </span> </a> <a href="#" class="nav-item text-white/80 font-semibold hover:text-white text-sm 2xl:text-base" onclick="showSection('data')"> <span class="flex items-center space-x-1.5 2xl:space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg><span class="hidden 2xl:inline">Data Jurnal</span> </span> </a> <a href="#" class="nav-item text-white/80 font-semibold hover:text-white text-sm 2xl:text-base" onclick="showSection('analytics')"> <span class="flex items-center space-x-1.5 2xl:space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
        </svg><span class="hidden 2xl:inline">Analytics</span> </span> </a> <a href="#" class="nav-item text-white/80 font-semibold hover:text-white text-sm 2xl:text-base" onclick="showSection('reports')"> <span class="flex items-center space-x-1.5 2xl:space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg><span class="hidden 2xl:inline">Laporan</span> </span> </a>
     </nav><!-- Action Buttons - Desktop -->
     <div class="hidden lg:flex items-center space-x-2 lg:space-x-3 flex-shrink-0"><button onclick="toggleDarkMode()" class="action-button p-2 lg:p-3 text-white/80 hover:text-white rounded-lg lg:rounded-xl" title="Toggle Dark Mode">
       <svg id="theme-icon" class="w-4 h-4 lg:w-5 lg:h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
       </svg></button> <button onclick="syncData()" class="action-button text-white px-3 py-2 lg:px-6 lg:py-3 rounded-lg lg:rounded-xl font-semibold flex items-center space-x-1 lg:space-x-2 text-sm lg:text-base">
       <svg class="w-4 h-4 lg:w-5 lg:h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
       </svg><span class="hidden lg:inline">Sync Data</span> <span class="lg:hidden">Sync</span> </button>
     </div><!-- Mobile menu button --> <button class="lg:hidden action-button text-white p-2 rounded-lg flex-shrink-0 ml-2" onclick="toggleMobileMenu()">
      <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg></button>
    </div><!-- Tablet Navigation (lg to xl) -->
    <div class="hidden lg:flex xl:hidden justify-center pb-3 border-t border-white/10 pt-3">
     <nav class="flex items-center space-x-1"><a href="#" class="nav-item active text-white font-semibold text-sm" onclick="showSection('dashboard')"> <span class="flex items-center space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v6H8V5z"></path>
        </svg><span>Dashboard</span> </span> </a> <a href="#" class="nav-item text-white/80 font-semibold hover:text-white text-sm" onclick="showSection('data')"> <span class="flex items-center space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg><span>Data Jurnal</span> </span> </a> <a href="#" class="nav-item text-white/80 font-semibold hover:text-white text-sm" onclick="showSection('analytics')"> <span class="flex items-center space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
        </svg><span>Analytics</span> </span> </a> <a href="#" class="nav-item text-white/80 font-semibold hover:text-white text-sm" onclick="showSection('reports')"> <span class="flex items-center space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg><span>Laporan</span> </span> </a>
     </nav>
    </div><!-- Mobile Navigation -->
    <div id="mobile-menu" class="lg:hidden hidden pb-3">
     <div class="mobile-menu-modern p-3 sm:p-4 mt-3">
      <div class="flex flex-col space-y-2"><a href="#" class="nav-item active text-white font-semibold text-sm sm:text-base" onclick="showSection('dashboard'); toggleMobileMenu()"> <span class="flex items-center space-x-3">
         <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
         </svg><span>Dashboard</span> </span> </a> <a href="#" class="nav-item text-white/80 font-semibold hover:text-white text-sm sm:text-base" onclick="showSection('data'); toggleMobileMenu()"> <span class="flex items-center space-x-3">
         <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
         </svg><span>Data Jurnal</span> </span> </a> <a href="#" class="nav-item text-white/80 font-semibold hover:text-white text-sm sm:text-base" onclick="showSection('analytics'); toggleMobileMenu()"> <span class="flex items-center space-x-3">
         <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
         </svg><span>Analytics</span> </span> </a> <a href="#" class="nav-item text-white/80 font-semibold hover:text-white text-sm sm:text-base" onclick="showSection('reports'); toggleMobileMenu()"> <span class="flex items-center space-x-3">
         <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
         </svg><span>Laporan</span> </span> </a>
       <div class="pt-3 mt-3 border-t border-white/20">
        <div class="flex flex-col sm:flex-row items-stretch sm:items-center space-y-2 sm:space-y-0 sm:space-x-3"><button onclick="toggleDarkMode(); toggleMobileMenu()" class="action-button flex-1 p-3 text-white/80 hover:text-white rounded-xl flex items-center justify-center space-x-2 text-sm sm:text-base">
          <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg><span>Dark Mode</span> </button> <button onclick="syncData(); toggleMobileMenu()" class="action-button flex-1 p-3 text-white rounded-xl flex items-center justify-center space-x-2 text-sm sm:text-base">
          <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg><span>Sync Data</span> </button>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </header><!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><!-- Dashboard Section -->
   <section id="dashboard-section" class="fade-in-up"><!-- Welcome Banner -->
    <div class="card-modern rounded-2xl p-8 mb-8 text-center">
     <div class="max-w-3xl mx-auto">
      <h2 id="welcome-message" class="text-4xl font-bold text-gray-900 mb-4">Selamat datang di sistem e-jurnal pembelajaran digital</h2>
      <p id="class-info" class="text-xl text-gray-600 mb-6">Kelas X E1 - Tahun Pelajaran 2025/2026</p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center"><button onclick="syncData()" class="btn-modern text-white px-8 py-3 rounded-xl font-semibold flex items-center justify-center space-x-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg><span>Sinkronkan Data</span> </button> <button onclick="showSection('data')" class="bg-white text-indigo-600 border-2 border-indigo-600 px-8 py-3 rounded-xl font-semibold hover:bg-indigo-50 transition-all duration-300"> Lihat Data Jurnal </button>
      </div>
     </div>
    </div><!-- Quick Stats Modern -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
     <div class="stats-modern rounded-2xl p-6 text-center card-modern">
      <div class="w-14 h-14 gradient-primary rounded-2xl mx-auto mb-4 flex items-center justify-center">
       <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
       </svg>
      </div>
      <h3 class="text-3xl font-bold text-gray-900 mb-2" id="total-entries">0</h3>
      <p class="text-gray-600 font-medium">Total Entri Jurnal</p>
      <div class="progress-bar mt-3">
       <div class="progress-fill" style="width: 75%"></div>
      </div>
     </div>
     <div class="stats-modern rounded-2xl p-6 text-center card-modern">
      <div class="w-14 h-14 gradient-success rounded-2xl mx-auto mb-4 flex items-center justify-center">
       <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
       </svg>
      </div>
      <h3 class="text-3xl font-bold text-gray-900 mb-2" id="total-teachers">0</h3>
      <p class="text-gray-600 font-medium">Guru Aktif</p>
      <div class="progress-bar mt-3">
       <div class="progress-fill" style="width: 90%"></div>
      </div>
     </div>
     <div class="stats-modern rounded-2xl p-6 text-center card-modern">
      <div class="w-14 h-14 gradient-warning rounded-2xl mx-auto mb-4 flex items-center justify-center">
       <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
       </svg>
      </div>
      <h3 class="text-3xl font-bold text-gray-900 mb-2" id="total-subjects">0</h3>
      <p class="text-gray-600 font-medium">Mata Pelajaran</p>
      <div class="progress-bar mt-3">
       <div class="progress-fill" style="width: 85%"></div>
      </div>
     </div>
     <div class="stats-modern rounded-2xl p-6 text-center card-modern">
      <div class="w-14 h-14 gradient-secondary rounded-2xl mx-auto mb-4 flex items-center justify-center">
       <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
       </svg>
      </div>
      <h3 class="text-3xl font-bold text-gray-900 mb-2" id="attendance-rate">0%</h3>
      <p class="text-gray-600 font-medium">Tingkat Kehadiran</p>
      <div class="progress-bar mt-3">
       <div class="progress-fill" style="width: 92%"></div>
      </div>
     </div>
    </div><!-- Recent Activity & Quick Charts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><!-- Recent Activity -->
     <div class="card-modern rounded-2xl p-6">
      <div class="flex items-center justify-between mb-6">
       <h3 class="text-xl font-bold text-gray-900">Aktivitas Terbaru</h3><button onclick="showSection('data')" class="text-indigo-600 hover:text-indigo-800 font-medium text-sm"> Lihat Semua â†’ </button>
      </div>
      <div id="recent-activity" class="space-y-4"><!-- Activity items will be populated here -->
      </div>
     </div><!-- Quick Chart -->
     <div class="card-modern rounded-2xl p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-6">Kehadiran Guru Minggu Ini</h3>
      <div class="relative h-64">
       <canvas id="quickChart"></canvas>
      </div>
     </div>
    </div>
   </section><!-- Data Section -->
   <section id="data-section" class="hidden">
    <div class="mb-8">
     <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
      <h2 class="text-3xl font-bold text-gray-900 mb-4 sm:mb-0">Data Jurnal Pembelajaran</h2>
      <div class="flex space-x-3"><button onclick="exportData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg> Export </button> <button onclick="printData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
        </svg> Print </button>
      </div>
     </div><!-- Advanced Filters -->
     <div class="filter-modern rounded-2xl p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-4">
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ” Pencarian</label> <input type="text" id="search-input" placeholder="Cari guru, mapel, atau kegiatan..." class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all" oninput="filterData()">
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ“… Dari Tanggal</label> <input type="date" id="date-from" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all" onchange="filterData()">
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ“… Sampai Tanggal</label> <input type="date" id="date-to" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all" onchange="filterData()">
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ‘¨â€ğŸ« Filter Guru</label> <select id="teacher-filter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all" onchange="filterData()"> <option value="">Semua Guru</option> </select>
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ“š Filter Mapel</label> <select id="subject-filter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all" onchange="filterData()"> <option value="">Semua Mapel</option> </select>
       </div>
       <div class="flex items-end"><button onclick="resetFilters()" class="w-full px-4 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-xl font-medium transition-colors"> Reset Filter </button>
       </div>
      </div><!-- Pagination Controls -->
      <div class="flex flex-col sm:flex-row justify-between items-center pt-4 border-t border-gray-200">
       <div class="flex items-center space-x-4 mb-4 sm:mb-0"><label class="text-sm font-semibold text-gray-700">ğŸ“„ Tampilkan:</label> <select id="entries-per-page" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all" onchange="changeEntriesPerPage()"> <option value="10">10 entri</option> <option value="25" selected>25 entri</option> <option value="50">50 entri</option> <option value="100">100 entri</option> <option value="all">Semua data</option> </select>
       </div>
       <div class="flex items-center space-x-2"><span id="data-info" class="text-sm text-gray-600 mr-4">Menampilkan 0-0 dari 0 entri</span> <button id="prev-page" onclick="changePage(-1)" class="px-3 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled> â† Sebelumnya </button> <span id="page-info" class="px-3 py-2 bg-indigo-100 text-indigo-700 rounded-lg font-semibold">1</span> <button id="next-page" onclick="changePage(1)" class="px-3 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled> Selanjutnya â†’ </button>
       </div>
      </div>
     </div><!-- Data Table Modern -->
     <div class="table-modern rounded-2xl shadow-xl overflow-hidden">
      <div class="overflow-x-auto">
       <table class="min-w-full">
        <thead>
         <tr>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider border-r border-indigo-400"><button onclick="sortByDate()" class="flex items-center justify-center w-full hover:bg-indigo-700 rounded px-2 py-1 transition-colors"> ğŸ“… Tanggal 
            <svg id="date-sort-icon" class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg></button></th>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider border-r border-indigo-400">ğŸ“† Hari</th>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider border-r border-indigo-400">ğŸ‘¨â€ğŸ« Nama Guru</th>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider border-r border-indigo-400">âœ… Kehadiran</th>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider border-r border-indigo-400">ğŸ« Kelas</th>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider border-r border-indigo-400">ğŸ“š Mapel</th>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider border-r border-indigo-400">ğŸ¯ Elemen</th>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider border-r border-indigo-400">ğŸ“‹ CP</th>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider border-r border-indigo-400">ğŸ“– Kegiatan</th>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider border-r border-indigo-400">âŒ Alpa</th>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider border-r border-indigo-400">ğŸ“ Izin</th>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider border-r border-indigo-400">ğŸ¥ Sakit</th>
          <th class="px-4 py-4 text-center text-sm font-bold text-white uppercase tracking-wider">ğŸ“ Catatan</th>
         </tr>
        </thead>
        <tbody id="data-table-body" class="divide-y divide-gray-200"><!-- Data will be populated here -->
        </tbody>
       </table>
      </div>
     </div>
    </div>
   </section><!-- Analytics Section -->
   <section id="analytics-section" class="hidden">
    <div class="mb-8">
     <h2 class="text-3xl font-bold text-gray-900 mb-6">ğŸ“Š Analytics Dashboard</h2><!-- Analytics Filters -->
     <div class="filter-modern rounded-2xl p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ“… Periode</label> <select id="period-filter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent" onchange="updateAnalytics()"> <option value="7">7 Hari Terakhir</option> <option value="14">14 Hari Terakhir</option> <option value="30">30 Hari Terakhir</option> <option value="all">Semua Data</option> </select>
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ‘¨â€ğŸ« Filter Guru</label> <select id="teacher-filter-analytics" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent" onchange="updateAnalytics()"> <option value="">Semua Guru</option> </select>
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ“š Filter Mapel</label> <select id="subject-filter-analytics" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent" onchange="updateAnalytics()"> <option value="">Semua Mapel</option> </select>
       </div>
       <div class="flex items-end"><button onclick="resetAnalyticsFilters()" class="w-full px-4 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-xl font-medium transition-colors"> Reset Filter </button>
       </div>
      </div>
     </div><!-- Analytics Summary Cards -->
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="card-modern rounded-2xl p-6 text-center">
       <div class="w-14 h-14 bg-green-500 rounded-2xl mx-auto mb-4 flex items-center justify-center">
        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
       </div>
       <h3 class="text-2xl font-bold text-gray-900 mb-2" id="analytics-attendance-rate">0%</h3>
       <p class="text-gray-600 font-medium">Tingkat Kehadiran</p>
       <p class="text-xs text-gray-500 mt-1" id="analytics-period-info">Periode yang dipilih</p>
      </div>
      <div class="card-modern rounded-2xl p-6 text-center">
       <div class="w-14 h-14 bg-blue-500 rounded-2xl mx-auto mb-4 flex items-center justify-center">
        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
       </div>
       <h3 class="text-2xl font-bold text-gray-900 mb-2" id="analytics-active-teachers">0</h3>
       <p class="text-gray-600 font-medium">Guru Aktif</p>
       <p class="text-xs text-gray-500 mt-1" id="analytics-avg-teaching">Rata-rata mengajar</p>
      </div>
      <div class="card-modern rounded-2xl p-6 text-center">
       <div class="w-14 h-14 bg-purple-500 rounded-2xl mx-auto mb-4 flex items-center justify-center">
        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
        </svg>
       </div>
       <h3 class="text-2xl font-bold text-gray-900 mb-2" id="analytics-subject-variety">0</h3>
       <p class="text-gray-600 font-medium">Variasi Mapel</p>
       <p class="text-xs text-gray-500 mt-1" id="analytics-most-taught">Paling banyak diajarkan</p>
      </div>
      <div class="card-modern rounded-2xl p-6 text-center">
       <div class="w-14 h-14 bg-orange-500 rounded-2xl mx-auto mb-4 flex items-center justify-center">
        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
        </svg>
       </div>
       <h3 class="text-2xl font-bold text-gray-900 mb-2" id="analytics-daily-avg">0</h3>
       <p class="text-gray-600 font-medium">Rata-rata Harian</p>
       <p class="text-xs text-gray-500 mt-1">Pembelajaran per hari</p>
      </div>
     </div><!-- Analytics Charts Grid -->
     <div class="grid grid-cols-1 xl:grid-cols-2 gap-8"><!-- Teacher Attendance Chart -->
      <div class="chart-container">
       <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold text-gray-900">ğŸ“ˆ Status Kehadiran Guru</h3>
        <div class="text-sm text-gray-500">
         Total: <span id="teacher-attendance-total">0</span> entri
        </div>
       </div>
       <div class="relative h-80">
        <canvas id="teacherAttendanceChart"></canvas>
       </div>
      </div><!-- Subject Distribution Chart -->
      <div class="chart-container">
       <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold text-gray-900">ğŸ“š Distribusi Mata Pelajaran</h3>
        <div class="text-sm text-gray-500"><span id="subject-count">0</span> mata pelajaran
        </div>
       </div>
       <div class="relative h-80">
        <canvas id="subjectChart"></canvas>
       </div>
      </div><!-- Daily Trend Chart -->
      <div class="chart-container">
       <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold text-gray-900">ğŸ“Š Trend Pembelajaran Harian</h3>
        <div class="text-sm text-gray-500" id="daily-trend-info">
         14 hari terakhir
        </div>
       </div>
       <div class="relative h-80">
        <canvas id="dailyTrendChart"></canvas>
       </div>
      </div><!-- Top Teachers Chart -->
      <div class="chart-container">
       <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold text-gray-900">ğŸ† Guru Paling Aktif</h3>
        <div class="text-sm text-gray-500">
         Top 10 guru dengan analisis kehadiran
        </div>
       </div>
       <div class="relative h-80">
        <canvas id="topTeachersChart"></canvas>
       </div>
      </div>
     </div><!-- Additional Analytics Insights -->
     <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8"><!-- Performance Insights -->
      <div class="chart-container">
       <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ’¡ Insight Kinerja</h3>
       <div id="performance-insights" class="space-y-4"><!-- Insights will be populated here -->
       </div>
      </div><!-- Recommendations -->
      <div class="chart-container">
       <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ¯ Rekomendasi</h3>
       <div id="recommendations" class="space-y-4"><!-- Recommendations will be populated here -->
       </div>
      </div>
     </div>
    </div>
   </section><!-- Reports Section -->
   <section id="reports-section" class="hidden">
    <div class="mb-8">
     <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
      <h2 class="text-3xl font-bold text-gray-900 mb-4 sm:mb-0">ğŸ“‹ Laporan Pembelajaran</h2>
      <div class="flex space-x-3"><button onclick="generateFullReport()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg> Generate Laporan </button> <button onclick="exportReportData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg> Export Laporan </button> <button onclick="printReport()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
        </svg> Print </button>
      </div>
     </div><!-- Report Filters -->
     <div class="filter-modern rounded-2xl p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ“… Periode Laporan</label> <select id="report-period-filter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent" onchange="updateReports()"> <option value="7">7 Hari Terakhir</option> <option value="14">14 Hari Terakhir</option> <option value="30" selected>30 Hari Terakhir</option> <option value="90">3 Bulan Terakhir</option> <option value="all">Semua Data</option> </select>
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ‘¨â€ğŸ« Filter Guru</label> <select id="teacher-filter-reports" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent" onchange="updateReports()"> <option value="">Semua Guru</option> </select>
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ“š Filter Mapel</label> <select id="subject-filter-reports" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent" onchange="updateReports()"> <option value="">Semua Mapel</option> </select>
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ“Š Jenis Laporan</label> <select id="report-type-filter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent" onchange="updateReports()"> <option value="overview">Overview Umum</option> <option value="attendance">Kehadiran Detail</option> <option value="performance">Kinerja Guru</option> <option value="subjects">Analisis Mapel</option> </select>
       </div>
       <div class="flex items-end"><button onclick="resetReportFilters()" class="w-full px-4 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-xl font-medium transition-colors"> Reset Filter </button>
       </div>
      </div>
     </div><!-- Report Summary Cards -->
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="card-modern rounded-2xl p-6 text-center">
       <div class="w-14 h-14 bg-green-500 rounded-2xl mx-auto mb-4 flex items-center justify-center">
        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
       </div>
       <h3 class="text-2xl font-bold text-gray-900 mb-2" id="total-hadir-report">0</h3>
       <p class="text-gray-600 font-medium">Total Siswa Hadir</p>
       <div class="mt-2"><span class="text-xs text-green-600 font-semibold" id="hadir-percentage">0%</span> <span class="text-xs text-gray-500"> dari total</span>
       </div>
      </div>
      <div class="card-modern rounded-2xl p-6 text-center">
       <div class="w-14 h-14 bg-red-500 rounded-2xl mx-auto mb-4 flex items-center justify-center">
        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
       </div>
       <h3 class="text-2xl font-bold text-gray-900 mb-2" id="total-alpa-report">0</h3>
       <p class="text-gray-600 font-medium">Total Alpa</p>
       <div class="mt-2"><span class="text-xs text-red-600 font-semibold" id="alpa-percentage">0%</span> <span class="text-xs text-gray-500"> dari total</span>
       </div>
      </div>
      <div class="card-modern rounded-2xl p-6 text-center">
       <div class="w-14 h-14 bg-yellow-500 rounded-2xl mx-auto mb-4 flex items-center justify-center">
        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
        </svg>
       </div>
       <h3 class="text-2xl font-bold text-gray-900 mb-2" id="total-izin-report">0</h3>
       <p class="text-gray-600 font-medium">Total Izin</p>
       <div class="mt-2"><span class="text-xs text-yellow-600 font-semibold" id="izin-percentage">0%</span> <span class="text-xs text-gray-500"> dari total</span>
       </div>
      </div>
      <div class="card-modern rounded-2xl p-6 text-center">
       <div class="w-14 h-14 bg-purple-500 rounded-2xl mx-auto mb-4 flex items-center justify-center">
        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
        </svg>
       </div>
       <h3 class="text-2xl font-bold text-gray-900 mb-2" id="total-sakit-report">0</h3>
       <p class="text-gray-600 font-medium">Total Sakit</p>
       <div class="mt-2"><span class="text-xs text-purple-600 font-semibold" id="sakit-percentage">0%</span> <span class="text-xs text-gray-500"> dari total</span>
       </div>
      </div>
     </div><!-- Report Charts Grid -->
     <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8"><!-- Student Attendance Report -->
      <div class="chart-container">
       <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold text-gray-900">ğŸ“Š Distribusi Kehadiran Siswa</h3><button onclick="exportChart('studentAttendanceReportChart')" class="text-indigo-600 hover:text-indigo-800 font-medium text-sm"> Export Chart </button>
       </div>
       <div class="relative h-80">
        <canvas id="studentAttendanceReportChart"></canvas>
       </div>
       <div class="mt-4 text-sm text-gray-600" id="student-attendance-summary"><!-- Summary will be populated here -->
       </div>
      </div><!-- Teacher Performance Report -->
      <div class="chart-container">
       <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold text-gray-900">ğŸ‘¨â€ğŸ« Kinerja Kehadiran Guru</h3><button onclick="exportChart('teacherPerformanceReportChart')" class="text-indigo-600 hover:text-indigo-800 font-medium text-sm"> Export Chart </button>
       </div>
       <div class="relative h-80">
        <canvas id="teacherPerformanceReportChart"></canvas>
       </div>
       <div class="mt-4 text-sm text-gray-600" id="teacher-performance-summary"><!-- Summary will be populated here -->
       </div>
      </div><!-- Weekly Trend Report -->
      <div class="chart-container">
       <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold text-gray-900">ğŸ“ˆ Trend Kehadiran Mingguan</h3><button onclick="exportChart('weeklyTrendReportChart')" class="text-indigo-600 hover:text-indigo-800 font-medium text-sm"> Export Chart </button>
       </div>
       <div class="relative h-80">
        <canvas id="weeklyTrendReportChart"></canvas>
       </div>
       <div class="mt-4 text-sm text-gray-600" id="weekly-trend-summary"><!-- Summary will be populated here -->
       </div>
      </div><!-- Subject Analysis Report -->
      <div class="chart-container">
       <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold text-gray-900">ğŸ“š Analisis per Mata Pelajaran</h3><button onclick="exportChart('subjectAnalysisReportChart')" class="text-indigo-600 hover:text-indigo-800 font-medium text-sm"> Export Chart </button>
       </div>
       <div class="relative h-80">
        <canvas id="subjectAnalysisReportChart"></canvas>
       </div>
       <div class="mt-4 text-sm text-gray-600" id="subject-analysis-summary"><!-- Summary will be populated here -->
       </div>
      </div>
     </div><!-- Detailed Report Tables -->
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8"><!-- Top Performing Teachers -->
      <div class="chart-container">
       <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ† Guru Terbaik (Kehadiran)</h3>
       <div class="overflow-x-auto">
        <table class="min-w-full">
         <thead class="bg-gradient-to-r from-green-500 to-green-600">
          <tr>
           <th class="px-4 py-3 text-left text-xs font-bold text-white uppercase tracking-wider">Ranking</th>
           <th class="px-4 py-3 text-left text-xs font-bold text-white uppercase tracking-wider">Nama Guru</th>
           <th class="px-4 py-3 text-center text-xs font-bold text-white uppercase tracking-wider">Kehadiran</th>
           <th class="px-4 py-3 text-center text-xs font-bold text-white uppercase tracking-wider">Total Mengajar</th>
          </tr>
         </thead>
         <tbody id="top-teachers-table" class="bg-white divide-y divide-gray-200"><!-- Data will be populated here -->
         </tbody>
        </table>
       </div>
      </div><!-- Subject Performance -->
      <div class="chart-container">
       <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ“Š Performa per Mata Pelajaran</h3>
       <div class="overflow-x-auto">
        <table class="min-w-full">
         <thead class="bg-gradient-to-r from-blue-500 to-blue-600">
          <tr>
           <th class="px-4 py-3 text-left text-xs font-bold text-white uppercase tracking-wider">Mata Pelajaran</th>
           <th class="px-4 py-3 text-center text-xs font-bold text-white uppercase tracking-wider">Frekuensi</th>
           <th class="px-4 py-3 text-center text-xs font-bold text-white uppercase tracking-wider">Kehadiran Guru</th>
           <th class="px-4 py-3 text-center text-xs font-bold text-white uppercase tracking-wider">Rata-rata Siswa</th>
          </tr>
         </thead>
         <tbody id="subject-performance-table" class="bg-white divide-y divide-gray-200"><!-- Data will be populated here -->
         </tbody>
        </table>
       </div>
      </div>
     </div><!-- Report Insights and Recommendations -->
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><!-- Report Insights -->
      <div class="chart-container">
       <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ’¡ Insight Laporan</h3>
       <div id="report-insights" class="space-y-4"><!-- Insights will be populated here -->
       </div>
      </div><!-- Report Recommendations -->
      <div class="chart-container">
       <h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ¯ Rekomendasi Berdasarkan Laporan</h3>
       <div id="report-recommendations" class="space-y-4"><!-- Recommendations will be populated here -->
       </div>
      </div>
     </div>
    </div>
   </section>
  </main><!-- Modern Footer -->
  <footer class="bg-gray-900 text-white mt-20">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
     <div class="flex items-center space-x-3">
      <div class="w-10 h-10 gradient-primary rounded-xl flex items-center justify-center">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
       </svg>
      </div>
      <div><span class="font-bold text-lg">E-Jurnal Kelas X E1</span>
       <p class="text-gray-400 text-sm">Sistem Pembelajaran Digital</p>
      </div>
     </div>
     <div class="text-center md:text-right">
      <p id="footer-text" class="text-gray-400 text-sm">Â© 2025 E-Jurnal Kelas X E1. Sistem Pembelajaran Digital.</p>
     </div>
    </div>
   </div>
  </footer><!-- Floating Action Button --> <button class="floating-action" onclick="scrollToTop()" title="Kembali ke atas">
   <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
   </svg></button>
  <script>
        // Configuration
        const defaultConfig = {
            site_title: "E-JURNAL KELAS",
            school_name: "SMAN 1 Singkep Selatan",
            welcome_message: "Selamat datang di sistem e-jurnal pembelajaran digital",
            class_info: "Kelas X E1 - Tahun Pelajaran 2025/2026",
            footer_text: "Â© 2025 E-Jurnal Kelas X E1. Sistem Pembelajaran Digital."
        };

        // Global variables
        let journalData = [];
        let filteredData = [];
        let currentSection = 'dashboard';
        let dateSortOrder = 'desc';
        let chartInstances = {};
        let isDarkMode = false;
        
        // Pagination variables
        let currentPage = 1;
        let entriesPerPage = 25;
        let totalPages = 1;

        // CSV URL
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSMEo3epa7yanFo37AeYFvZAXvPz64InQcN1TY1Fj1guUtYwPxuhPtIUD54pInGwi6yUI4UXuYV3sXJ/pub?gid=942476473&single=true&output=csv';

        // Initialize the application
        async function init() {
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    render,
                    mapToCapabilities,
                    mapToEditPanelValues
                });
            }
            
            await syncData();
            setupEventListeners();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Smooth scrolling for navigation
            document.addEventListener('click', (e) => {
                if (e.target.matches('a[href^="#"]')) {
                    e.preventDefault();
                }
            });

            // Auto-hide mobile menu when clicking outside
            document.addEventListener('click', (e) => {
                const mobileMenu = document.getElementById('mobile-menu');
                const menuButton = e.target.closest('button');
                
                if (!mobileMenu.contains(e.target) && !menuButton?.onclick?.toString().includes('toggleMobileMenu')) {
                    mobileMenu.classList.add('hidden');
                }
            });
        }

        // Render function for Element SDK
        async function render(config) {
            const siteTitle = config.site_title || defaultConfig.site_title;
            const schoolName = config.school_name || defaultConfig.school_name;
            const welcomeMessage = config.welcome_message || defaultConfig.welcome_message;
            const classInfo = config.class_info || defaultConfig.class_info;
            const footerText = config.footer_text || defaultConfig.footer_text;

            document.getElementById('site-title').textContent = siteTitle;
            document.getElementById('school-name').textContent = schoolName;
            document.getElementById('welcome-message').textContent = welcomeMessage;
            document.getElementById('class-info').textContent = classInfo;
            document.getElementById('footer-text').textContent = footerText;
        }

        // Map to capabilities for Element SDK
        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        // Map to edit panel values for Element SDK
        function mapToEditPanelValues(config) {
            return new Map([
                ['site_title', config.site_title || defaultConfig.site_title],
                ['school_name', config.school_name || defaultConfig.school_name],
                ['welcome_message', config.welcome_message || defaultConfig.welcome_message],
                ['class_info', config.class_info || defaultConfig.class_info],
                ['footer_text', config.footer_text || defaultConfig.footer_text]
            ]);
        }

        // Parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const data = [];
            
            const headers = parseCSVLine(lines[0]);

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = parseCSVLine(lines[i]);
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    data.push(row);
                }
            }

            return data;
        }

        // Parse CSV line with proper comma handling
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        // Sync data from Google Sheets
        async function syncData() {
            const button = event?.target;
            if (button) {
                button.innerHTML = '<div class="loading-modern"></div> Sinkronisasi...';
                button.disabled = true;
            }

            try {
                const response = await fetch(CSV_URL);
                const csvText = await response.text();
                journalData = parseCSV(csvText);
                filteredData = [...journalData];
                
                updateStats();
                populateFilters();
                updatePagination();
                renderDataTable();
                updateAllCharts();
                updateRecentActivity();
                
                showNotification('âœ… Data berhasil disinkronkan!', 'success');
            } catch (error) {
                console.error('Error syncing data:', error);
                showNotification('âŒ Gagal sinkronisasi data. Silakan coba lagi.', 'error');
            } finally {
                if (button) {
                    button.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span>Sync</span>';
                    button.disabled = false;
                }
            }
        }

        // Update statistics
        function updateStats() {
            const totalEntries = journalData.length;
            const uniqueTeachers = new Set(journalData.map(row => row['NAMA GURU'])).size;
            const uniqueSubjects = new Set(journalData.map(row => row['MAPEL'])).size;
            
            const presentCount = journalData.filter(row => 
                row['KEHADIRAN GURU'] === 'Hadir' || row['KEHADIRAN GURU'] === 'Masuk Kelas'
            ).length;
            const attendanceRate = totalEntries > 0 ? Math.round((presentCount / totalEntries) * 100) : 0;

            document.getElementById('total-entries').textContent = totalEntries.toLocaleString();
            document.getElementById('total-teachers').textContent = uniqueTeachers;
            document.getElementById('total-subjects').textContent = uniqueSubjects;
            document.getElementById('attendance-rate').textContent = attendanceRate + '%';

            // Update report stats
            const stats = journalData.reduce((acc, row) => {
                acc.hadir += parseInt(row['HADIR'] || 0);
                acc.alpa += parseInt(row['ALPA'] || 0);
                acc.izin += parseInt(row['IZIN'] || 0);
                acc.sakit += parseInt(row['SAKIT'] || 0);
                return acc;
            }, { hadir: 0, alpa: 0, izin: 0, sakit: 0 });

            const reportElements = {
                'total-hadir-report': stats.hadir,
                'total-alpa-report': stats.alpa,
                'total-izin-report': stats.izin,
                'total-sakit-report': stats.sakit
            };

            Object.entries(reportElements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value.toLocaleString();
            });
        }

        // Update recent activity
        function updateRecentActivity() {
            const recentActivityContainer = document.getElementById('recent-activity');
            if (!recentActivityContainer) return;

            const recentData = journalData
                .sort((a, b) => {
                    const dateA = parseDate(a['TANGGAL']);
                    const dateB = parseDate(b['TANGGAL']);
                    return dateB - dateA;
                })
                .slice(0, 5);

            recentActivityContainer.innerHTML = recentData.map(row => {
                const status = getAttendanceStatus(row['KEHADIRAN GURU']);
                return `
                    <div class="flex items-center space-x-4 p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors">
                        <div class="w-10 h-10 ${status.bgColor} rounded-full flex items-center justify-center">
                            <span class="text-sm font-bold ${status.textColor}">${status.icon}</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900 truncate">
                                ${row['NAMA GURU'] || 'Tidak diketahui'}
                            </p>
                            <p class="text-sm text-gray-500 truncate">
                                ${row['MAPEL'] || 'Tidak diketahui'} â€¢ ${row['TANGGAL'] || 'Tidak diketahui'}
                            </p>
                        </div>
                        <div class="flex-shrink-0">
                            <span class="status-badge ${status.class}">
                                ${row['KEHADIRAN GURU'] || 'Tidak diketahui'}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Get attendance status styling
        function getAttendanceStatus(status) {
            const statusLower = (status || '').toLowerCase().trim();
            
            if (statusLower.includes('masuk kelas') || statusLower === 'hadir') {
                return {
                    icon: 'âœ…',
                    class: 'status-present',
                    bgColor: 'bg-green-100',
                    textColor: 'text-green-600'
                };
            }
            
            if (statusLower.includes('tidak masuk kelas')) {
                return {
                    icon: 'âŒ',
                    class: 'status-absent',
                    bgColor: 'bg-red-100',
                    textColor: 'text-red-600'
                };
            }
            
            if (statusLower.includes('sakit')) {
                return {
                    icon: 'ğŸ¥',
                    class: 'status-sick',
                    bgColor: 'bg-purple-100',
                    textColor: 'text-purple-600'
                };
            }
            
            if (statusLower.includes('izin')) {
                return {
                    icon: 'ğŸ“',
                    class: 'status-permission',
                    bgColor: 'bg-yellow-100',
                    textColor: 'text-yellow-600'
                };
            }
            
            return {
                icon: 'â“',
                class: 'bg-gray-100 text-gray-600',
                bgColor: 'bg-gray-100',
                textColor: 'text-gray-600'
            };
        }

        // Populate filter dropdowns
        function populateFilters() {
            const filters = [
                { id: 'teacher-filter', key: 'NAMA GURU' },
                { id: 'subject-filter', key: 'MAPEL' },
                { id: 'teacher-filter-analytics', key: 'NAMA GURU' },
                { id: 'subject-filter-analytics', key: 'MAPEL' },
                { id: 'teacher-filter-reports', key: 'NAMA GURU' },
                { id: 'subject-filter-reports', key: 'MAPEL' }
            ];

            filters.forEach(({ id, key }) => {
                const filterElement = document.getElementById(id);
                if (!filterElement) return;

                const currentValue = filterElement.value;
                const defaultOption = filterElement.querySelector('option[value=""]');
                filterElement.innerHTML = '';
                
                if (defaultOption) {
                    filterElement.appendChild(defaultOption.cloneNode(true));
                }

                const uniqueValues = [...new Set(journalData.map(row => row[key]))]
                    .filter(value => value && value.trim() !== '' && value !== '-')
                    .sort((a, b) => a.localeCompare(b, 'id', { sensitivity: 'base' }));

                uniqueValues.forEach(value => {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = value;
                    if (value === currentValue) option.selected = true;
                    filterElement.appendChild(option);
                });
            });
        }

        // Parse date in DD/MM/YYYY format
        function parseDate(dateStr) {
            if (!dateStr || dateStr === '-') return null;
            
            const parts = dateStr.split('/');
            if (parts.length === 3) {
                const day = parseInt(parts[0]);
                const month = parseInt(parts[1]) - 1;
                const year = parseInt(parts[2]);
                return new Date(year, month, day);
            }
            
            return new Date(dateStr);
        }

        // Filter data
        function filterData() {
            const searchTerm = document.getElementById('search-input')?.value.toLowerCase() || '';
            const teacherFilter = document.getElementById('teacher-filter')?.value || '';
            const subjectFilter = document.getElementById('subject-filter')?.value || '';
            const dateFrom = document.getElementById('date-from')?.value || '';
            const dateTo = document.getElementById('date-to')?.value || '';
            
            filteredData = journalData.filter(row => {
                const matchesSearch = !searchTerm || 
                    Object.values(row).some(value => 
                        value.toString().toLowerCase().includes(searchTerm)
                    );
                
                const matchesTeacher = !teacherFilter || row['NAMA GURU'] === teacherFilter;
                const matchesSubject = !subjectFilter || row['MAPEL'] === subjectFilter;
                
                let matchesDate = true;
                if (dateFrom || dateTo) {
                    const rowDate = parseDate(row['TANGGAL']);
                    if (rowDate) {
                        if (dateFrom) {
                            const fromDate = new Date(dateFrom);
                            matchesDate = matchesDate && rowDate >= fromDate;
                        }
                        if (dateTo) {
                            const toDate = new Date(dateTo);
                            toDate.setHours(23, 59, 59, 999);
                            matchesDate = matchesDate && rowDate <= toDate;
                        }
                    } else {
                        matchesDate = false;
                    }
                }
                
                return matchesSearch && matchesTeacher && matchesSubject && matchesDate;
            });
            
            sortFilteredData();
            currentPage = 1; // Reset to first page when filtering
            updatePagination();
            renderDataTable();
        }

        // Update pagination info
        function updatePagination() {
            const totalEntries = filteredData.length;
            
            if (entriesPerPage === 'all') {
                totalPages = 1;
                currentPage = 1;
            } else {
                totalPages = Math.ceil(totalEntries / entriesPerPage);
                if (currentPage > totalPages) currentPage = totalPages || 1;
            }
            
            // Update pagination controls
            const prevButton = document.getElementById('prev-page');
            const nextButton = document.getElementById('next-page');
            const pageInfo = document.getElementById('page-info');
            const dataInfo = document.getElementById('data-info');
            
            if (prevButton) prevButton.disabled = currentPage <= 1;
            if (nextButton) nextButton.disabled = currentPage >= totalPages;
            
            if (pageInfo) {
                if (entriesPerPage === 'all') {
                    pageInfo.textContent = '1';
                } else {
                    pageInfo.textContent = `${currentPage} / ${totalPages}`;
                }
            }
            
            if (dataInfo) {
                if (totalEntries === 0) {
                    dataInfo.textContent = 'Menampilkan 0-0 dari 0 entri';
                } else if (entriesPerPage === 'all') {
                    dataInfo.textContent = `Menampilkan 1-${totalEntries} dari ${totalEntries} entri`;
                } else {
                    const startEntry = (currentPage - 1) * entriesPerPage + 1;
                    const endEntry = Math.min(currentPage * entriesPerPage, totalEntries);
                    dataInfo.textContent = `Menampilkan ${startEntry}-${endEntry} dari ${totalEntries} entri`;
                }
            }
        }

        // Change entries per page
        function changeEntriesPerPage() {
            const select = document.getElementById('entries-per-page');
            entriesPerPage = select.value === 'all' ? 'all' : parseInt(select.value);
            currentPage = 1;
            updatePagination();
            renderDataTable();
        }

        // Change page
        function changePage(direction) {
            if (entriesPerPage === 'all') return;
            
            const newPage = currentPage + direction;
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                updatePagination();
                renderDataTable();
                
                // Scroll to top of table
                const tableContainer = document.querySelector('.table-modern');
                if (tableContainer) {
                    tableContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        }

        // Sort filtered data by date
        function sortFilteredData() {
            filteredData.sort((a, b) => {
                const dateA = parseDate(a['TANGGAL']);
                const dateB = parseDate(b['TANGGAL']);
                
                if (!dateA && !dateB) return 0;
                if (!dateA) return 1;
                if (!dateB) return -1;
                
                return dateSortOrder === 'asc' ? dateA - dateB : dateB - dateA;
            });
        }

        // Sort by date
        function sortByDate() {
            dateSortOrder = dateSortOrder === 'asc' ? 'desc' : 'asc';
            
            const icon = document.getElementById('date-sort-icon');
            if (icon) {
                icon.innerHTML = dateSortOrder === 'asc' 
                    ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>'
                    : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>';
            }
            
            sortFilteredData();
            renderDataTable();
        }

        // Truncate text
        function truncateText(text, maxLength) {
            if (!text || text === '-') return text;
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        // Render data table
        function renderDataTable() {
            const tbody = document.getElementById('data-table-body');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="13" class="px-6 py-12 text-center text-gray-500">
                            <div class="flex flex-col items-center">
                                <svg class="w-16 h-16 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <p class="text-xl font-semibold mb-2">Tidak ada data yang ditemukan</p>
                                <p class="text-sm">Coba ubah filter atau kriteria pencarian Anda</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Calculate pagination
            let displayData = filteredData;
            if (entriesPerPage !== 'all') {
                const startIndex = (currentPage - 1) * entriesPerPage;
                const endIndex = startIndex + entriesPerPage;
                displayData = filteredData.slice(startIndex, endIndex);
            }
            
            displayData.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-indigo-50 transition-all duration-200';
                
                const attendanceStatus = getAttendanceStatus(row['KEHADIRAN GURU']);
                
                // Calculate actual row number
                const rowNumber = entriesPerPage === 'all' ? index + 1 : (currentPage - 1) * entriesPerPage + index + 1;
                
                tr.innerHTML = `
                    <td class="px-4 py-3 text-center text-sm text-gray-900 border-r border-gray-200 font-medium">${truncateText(row['TANGGAL'], 10) || '-'}</td>
                    <td class="px-4 py-3 text-center text-sm text-gray-900 border-r border-gray-200">${truncateText(row['HARI'], 8) || '-'}</td>
                    <td class="px-4 py-3 text-center text-sm font-semibold text-gray-900 border-r border-gray-200" title="${row['NAMA GURU'] || '-'}">${truncateText(row['NAMA GURU'], 18) || '-'}</td>
                    <td class="px-4 py-3 text-center border-r border-gray-200">
                        <span class="status-badge ${attendanceStatus.class}">
                            ${attendanceStatus.icon} ${row['KEHADIRAN GURU'] || 'Tidak diketahui'}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-center text-sm text-gray-900 border-r border-gray-200 font-medium">${truncateText(row['KELAS'], 10) || '-'}</td>
                    <td class="px-4 py-3 text-center text-sm text-gray-900 border-r border-gray-200 font-medium" title="${row['MAPEL'] || '-'}">${truncateText(row['MAPEL'], 15) || '-'}</td>
                    <td class="px-4 py-3 text-center text-sm text-gray-900 border-r border-gray-200" title="${row['ELEMEN'] || '-'}">${truncateText(row['ELEMEN'], 20) || '-'}</td>
                    <td class="px-4 py-3 text-center text-sm text-gray-900 border-r border-gray-200" title="${row['CP'] || '-'}">${truncateText(row['CP'], 15) || '-'}</td>
                    <td class="px-4 py-3 text-center text-sm text-gray-900 border-r border-gray-200" title="${row['KEGIATAN PEMBELAJARAN'] || '-'}">${truncateText(row['KEGIATAN PEMBELAJARAN'], 25) || '-'}</td>
                    <td class="px-4 py-3 text-center text-sm font-bold text-red-600 border-r border-gray-200">${row['ALPA'] || '0'}</td>
                    <td class="px-4 py-3 text-center text-sm font-bold text-yellow-600 border-r border-gray-200">${row['IZIN'] || '0'}</td>
                    <td class="px-4 py-3 text-center text-sm font-bold text-purple-600 border-r border-gray-200">${row['SAKIT'] || '0'}</td>
                    <td class="px-4 py-3 text-center text-sm text-gray-900" title="${row['CATATAN'] || '-'}">${truncateText(row['CATATAN'], 20) || '-'}</td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // Destroy existing chart
        function destroyChart(chartId) {
            if (chartInstances[chartId]) {
                chartInstances[chartId].destroy();
                delete chartInstances[chartId];
            }
        }

        // Update all charts
        function updateAllCharts() {
            updateQuickChart();
            updateTeacherAttendanceChart();
            updateSubjectChart();
            updateDailyTrendChart();
            updateTopTeachersChart();
            updateStudentAttendanceReportChart();
            updateWeeklyAnalysisReportChart();
        }

        // Quick chart for dashboard
        function updateQuickChart() {
            const ctx = document.getElementById('quickChart');
            if (!ctx) return;
            
            destroyChart('quickChart');
            
            const last7Days = [];
            const today = new Date();
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                last7Days.push(date.toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit' }));
            }
            
            const dailyData = last7Days.map(dateStr => {
                return journalData.filter(row => {
                    const rowDate = parseDate(row['TANGGAL']);
                    if (!rowDate) return false;
                    const rowDateStr = rowDate.toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit' });
                    return rowDateStr === dateStr && (row['KEHADIRAN GURU'] === 'Hadir' || row['KEHADIRAN GURU'] === 'Masuk Kelas');
                }).length;
            });
            
            chartInstances['quickChart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: 'Guru Hadir',
                        data: dailyData,
                        borderColor: 'rgba(102, 126, 234, 1)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Update analytics charts with filtered data
        function updateAnalyticsCharts(data) {
            updateAnalyticsSummary(data);
            updateTeacherAttendanceChart(data);
            updateSubjectChart(data);
            updateDailyTrendChart(data);
            updateTopTeachersChart(data);
            updatePerformanceInsights(data);
            updateRecommendations(data);
        }

        // Update analytics summary cards
        function updateAnalyticsSummary(data) {
            const period = document.getElementById('period-filter')?.value || '7';
            
            // Calculate attendance rate
            const totalEntries = data.length;
            const presentEntries = data.filter(row => 
                row['KEHADIRAN GURU'] === 'Masuk Kelas' || row['KEHADIRAN GURU'] === 'Hadir'
            ).length;
            const attendanceRate = totalEntries > 0 ? ((presentEntries / totalEntries) * 100).toFixed(1) : 0;
            
            // Calculate active teachers
            const uniqueTeachers = new Set(data.map(row => row['NAMA GURU']).filter(name => name && name !== '-')).size;
            const avgTeaching = uniqueTeachers > 0 ? (totalEntries / uniqueTeachers).toFixed(1) : 0;
            
            // Calculate subject variety
            const subjectData = data.reduce((acc, row) => {
                const subject = row['MAPEL'];
                if (subject && subject !== '-') {
                    acc[subject] = (acc[subject] || 0) + 1;
                }
                return acc;
            }, {});
            const subjectCount = Object.keys(subjectData).length;
            const mostTaughtSubject = Object.entries(subjectData)
                .sort(([,a], [,b]) => b - a)[0]?.[0] || 'Tidak ada';
            
            // Calculate daily average
            const dailyData = data.reduce((acc, row) => {
                const date = row['TANGGAL'];
                if (date && date !== '-') {
                    acc[date] = (acc[date] || 0) + 1;
                }
                return acc;
            }, {});
            const uniqueDays = Object.keys(dailyData).length;
            const dailyAvg = uniqueDays > 0 ? (totalEntries / uniqueDays).toFixed(1) : 0;
            
            // Update UI elements
            document.getElementById('analytics-attendance-rate').textContent = attendanceRate + '%';
            document.getElementById('analytics-period-info').textContent = 
                period === 'all' ? 'Semua data' : `${period} hari terakhir`;
            
            document.getElementById('analytics-active-teachers').textContent = uniqueTeachers;
            document.getElementById('analytics-avg-teaching').textContent = `${avgTeaching} kali mengajar`;
            
            document.getElementById('analytics-subject-variety').textContent = subjectCount;
            document.getElementById('analytics-most-taught').textContent = 
                mostTaughtSubject.length > 15 ? mostTaughtSubject.substring(0, 15) + '...' : mostTaughtSubject;
            
            document.getElementById('analytics-daily-avg').textContent = dailyAvg;
            
            // Update daily trend info
            const trendInfo = document.getElementById('daily-trend-info');
            if (trendInfo) {
                const dayCount = Math.min(uniqueDays, 14);
                trendInfo.textContent = `${dayCount} hari data`;
            }
        }

        // Update performance insights
        function updatePerformanceInsights(data) {
            const container = document.getElementById('performance-insights');
            if (!container) return;
            
            const insights = [];
            
            // Attendance analysis
            const totalEntries = data.length;
            const presentEntries = data.filter(row => 
                row['KEHADIRAN GURU'] === 'Masuk Kelas' || row['KEHADIRAN GURU'] === 'Hadir'
            ).length;
            const attendanceRate = totalEntries > 0 ? (presentEntries / totalEntries) * 100 : 0;
            
            if (attendanceRate >= 95) {
                insights.push({
                    type: 'success',
                    icon: 'ğŸ‰',
                    title: 'Kehadiran Sangat Baik',
                    description: `Tingkat kehadiran guru mencapai ${attendanceRate.toFixed(1)}%, menunjukkan komitmen yang luar biasa.`
                });
            } else if (attendanceRate >= 85) {
                insights.push({
                    type: 'good',
                    icon: 'ğŸ‘',
                    title: 'Kehadiran Baik',
                    description: `Tingkat kehadiran ${attendanceRate.toFixed(1)}% sudah cukup baik, namun masih bisa ditingkatkan.`
                });
            } else {
                insights.push({
                    type: 'warning',
                    icon: 'âš ï¸',
                    title: 'Kehadiran Perlu Perhatian',
                    description: `Tingkat kehadiran ${attendanceRate.toFixed(1)}% masih di bawah standar ideal (85%).`
                });
            }
            
            // Teacher activity analysis
            const teacherActivity = data.reduce((acc, row) => {
                const teacher = row['NAMA GURU'];
                if (teacher && teacher !== '-') {
                    acc[teacher] = (acc[teacher] || 0) + 1;
                }
                return acc;
            }, {});
            
            const teacherCounts = Object.values(teacherActivity);
            const avgActivity = teacherCounts.length > 0 ? 
                teacherCounts.reduce((sum, count) => sum + count, 0) / teacherCounts.length : 0;
            
            const highActivityTeachers = Object.entries(teacherActivity)
                .filter(([,count]) => count > avgActivity * 1.5).length;
            
            if (highActivityTeachers > 0) {
                insights.push({
                    type: 'info',
                    icon: 'ğŸ“Š',
                    title: 'Distribusi Beban Mengajar',
                    description: `${highActivityTeachers} guru memiliki beban mengajar di atas rata-rata (${avgActivity.toFixed(1)} kali).`
                });
            }
            
            // Subject diversity analysis
            const subjectData = data.reduce((acc, row) => {
                const subject = row['MAPEL'];
                if (subject && subject !== '-') {
                    acc[subject] = (acc[subject] || 0) + 1;
                }
                return acc;
            }, {});
            
            const subjectCount = Object.keys(subjectData).length;
            if (subjectCount >= 10) {
                insights.push({
                    type: 'success',
                    icon: 'ğŸ“š',
                    title: 'Variasi Mata Pelajaran Tinggi',
                    description: `Terdapat ${subjectCount} mata pelajaran yang diajarkan, menunjukkan kurikulum yang beragam.`
                });
            }
            
            // Render insights
            container.innerHTML = insights.map(insight => `
                <div class="p-4 rounded-xl border-l-4 ${getInsightStyle(insight.type)}">
                    <div class="flex items-start space-x-3">
                        <span class="text-2xl">${insight.icon}</span>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900 mb-1">${insight.title}</h4>
                            <p class="text-sm text-gray-600">${insight.description}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Update recommendations
        function updateRecommendations(data) {
            const container = document.getElementById('recommendations');
            if (!container) return;
            
            const recommendations = [];
            
            // Analyze attendance patterns
            const totalEntries = data.length;
            const presentEntries = data.filter(row => 
                row['KEHADIRAN GURU'] === 'Masuk Kelas' || row['KEHADIRAN GURU'] === 'Hadir'
            ).length;
            const attendanceRate = totalEntries > 0 ? (presentEntries / totalEntries) * 100 : 0;
            
            if (attendanceRate < 85) {
                recommendations.push({
                    priority: 'high',
                    icon: 'ğŸ¯',
                    title: 'Tingkatkan Kehadiran Guru',
                    description: 'Implementasikan sistem monitoring kehadiran dan berikan insentif untuk guru dengan kehadiran konsisten.',
                    action: 'Buat kebijakan kehadiran yang jelas dan sistem reward'
                });
            }
            
            // Analyze teacher workload
            const teacherActivity = data.reduce((acc, row) => {
                const teacher = row['NAMA GURU'];
                if (teacher && teacher !== '-') {
                    acc[teacher] = (acc[teacher] || 0) + 1;
                }
                return acc;
            }, {});
            
            const teacherCounts = Object.values(teacherActivity);
            const maxLoad = Math.max(...teacherCounts);
            const minLoad = Math.min(...teacherCounts);
            
            if (maxLoad > minLoad * 2) {
                recommendations.push({
                    priority: 'medium',
                    icon: 'âš–ï¸',
                    title: 'Seimbangkan Beban Mengajar',
                    description: 'Terdapat ketimpangan beban mengajar antar guru. Pertimbangkan redistribusi jadwal.',
                    action: 'Review dan sesuaikan pembagian jadwal mengajar'
                });
            }
            
            // Analyze subject coverage
            const subjectData = data.reduce((acc, row) => {
                const subject = row['MAPEL'];
                if (subject && subject !== '-') {
                    acc[subject] = (acc[subject] || 0) + 1;
                }
                return acc;
            }, {});
            
            const sortedSubjects = Object.entries(subjectData).sort(([,a], [,b]) => a - b);
            const leastTaught = sortedSubjects.slice(0, 3);
            
            if (leastTaught.length > 0 && leastTaught[0][1] < 5) {
                recommendations.push({
                    priority: 'medium',
                    icon: 'ğŸ“–',
                    title: 'Perhatikan Mata Pelajaran Kurang Aktif',
                    description: `Beberapa mata pelajaran seperti ${leastTaught[0][0]} memiliki aktivitas pembelajaran yang rendah.`,
                    action: 'Evaluasi dan tingkatkan frekuensi pembelajaran'
                });
            }
            
            // Daily pattern analysis
            const dailyData = data.reduce((acc, row) => {
                const date = row['TANGGAL'];
                if (date && date !== '-') {
                    acc[date] = (acc[date] || 0) + 1;
                }
                return acc;
            }, {});
            
            const dailyCounts = Object.values(dailyData);
            const avgDaily = dailyCounts.length > 0 ? 
                dailyCounts.reduce((sum, count) => sum + count, 0) / dailyCounts.length : 0;
            
            if (avgDaily < 10) {
                recommendations.push({
                    priority: 'low',
                    icon: 'ğŸ“…',
                    title: 'Optimalkan Jadwal Harian',
                    description: `Rata-rata ${avgDaily.toFixed(1)} pembelajaran per hari. Pertimbangkan optimalisasi jadwal.`,
                    action: 'Review efektivitas penggunaan waktu pembelajaran'
                });
            }
            
            // Add general recommendations if no specific issues
            if (recommendations.length === 0) {
                recommendations.push({
                    priority: 'low',
                    icon: 'âœ¨',
                    title: 'Pertahankan Kinerja Baik',
                    description: 'Sistem pembelajaran berjalan dengan baik. Terus pertahankan dan tingkatkan kualitas.',
                    action: 'Lakukan evaluasi berkala untuk peningkatan berkelanjutan'
                });
            }
            
            // Render recommendations
            container.innerHTML = recommendations.map(rec => `
                <div class="p-4 rounded-xl border-l-4 ${getRecommendationStyle(rec.priority)}">
                    <div class="flex items-start space-x-3">
                        <span class="text-2xl">${rec.icon}</span>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-semibold text-gray-900">${rec.title}</h4>
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${getPriorityBadge(rec.priority)}">
                                    ${rec.priority.toUpperCase()}
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">${rec.description}</p>
                            <p class="text-xs text-gray-500 italic">ğŸ’¡ ${rec.action}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Helper functions for styling
        function getInsightStyle(type) {
            switch (type) {
                case 'success': return 'border-green-500 bg-green-50';
                case 'good': return 'border-blue-500 bg-blue-50';
                case 'warning': return 'border-yellow-500 bg-yellow-50';
                case 'info': return 'border-purple-500 bg-purple-50';
                default: return 'border-gray-500 bg-gray-50';
            }
        }

        function getRecommendationStyle(priority) {
            switch (priority) {
                case 'high': return 'border-red-500 bg-red-50';
                case 'medium': return 'border-yellow-500 bg-yellow-50';
                case 'low': return 'border-blue-500 bg-blue-50';
                default: return 'border-gray-500 bg-gray-50';
            }
        }

        function getPriorityBadge(priority) {
            switch (priority) {
                case 'high': return 'bg-red-100 text-red-800';
                case 'medium': return 'bg-yellow-100 text-yellow-800';
                case 'low': return 'bg-blue-100 text-blue-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Teacher attendance chart
        function updateTeacherAttendanceChart(data = journalData) {
            const ctx = document.getElementById('teacherAttendanceChart');
            if (!ctx) return;
            
            destroyChart('teacherAttendanceChart');
            
            const attendanceData = data.reduce((acc, row) => {
                const status = row['KEHADIRAN GURU'] || 'Tidak Diketahui';
                acc[status] = (acc[status] || 0) + 1;
                return acc;
            }, {});
            
            const totalElement = document.getElementById('teacher-attendance-total');
            if (totalElement) {
                totalElement.textContent = data.length;
            }
            
            // Enhanced color mapping for different attendance statuses
            const statusColors = {
                'Masuk Kelas': '#10B981',
                'Hadir': '#059669',
                'Tidak Masuk Kelas': '#EF4444',
                'Sakit, tidak ada tugas': '#8B5CF6',
                'Izin, tidak ada tugas': '#F59E0B',
                'Tidak Diketahui': '#6B7280'
            };
            
            const labels = Object.keys(attendanceData);
            const colors = labels.map(label => statusColors[label] || '#6B7280');
            
            chartInstances['teacherAttendanceChart'] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: Object.values(attendanceData),
                        backgroundColor: colors,
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 11
                                },
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                                    return data.labels.map((label, i) => {
                                        const value = data.datasets[0].data[i];
                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                        return {
                                            text: `${label}: ${value} (${percentage}%)`,
                                            fillStyle: data.datasets[0].backgroundColor[i],
                                            strokeStyle: data.datasets[0].backgroundColor[i],
                                            pointStyle: 'circle'
                                        };
                                    });
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((context.parsed / total) * 100).toFixed(1) : 0;
                                    return `${context.label}: ${context.parsed} entri (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Subject distribution chart
        function updateSubjectChart(data = journalData) {
            const ctx = document.getElementById('subjectChart');
            if (!ctx) return;
            
            destroyChart('subjectChart');
            
            const subjectData = data.reduce((acc, row) => {
                const subject = row['MAPEL'] || 'Tidak Diketahui';
                if (subject && subject.trim() !== '' && subject !== '-') {
                    acc[subject] = (acc[subject] || 0) + 1;
                }
                return acc;
            }, {});
            
            const countElement = document.getElementById('subject-count');
            if (countElement) {
                countElement.textContent = Object.keys(subjectData).length;
            }
            
            const sortedSubjects = Object.entries(subjectData)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 12); // Show top 12 subjects
            
            // Generate gradient colors for better visualization
            const colors = sortedSubjects.map((_, index) => {
                const hue = (index * 30) % 360;
                return `hsla(${hue}, 70%, 60%, 0.8)`;
            });
            
            const borderColors = sortedSubjects.map((_, index) => {
                const hue = (index * 30) % 360;
                return `hsla(${hue}, 70%, 50%, 1)`;
            });
            
            chartInstances['subjectChart'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedSubjects.map(([subject]) => {
                        // Smart truncation for better readability
                        if (subject.length > 12) {
                            const words = subject.split(' ');
                            if (words.length > 1) {
                                return words[0] + (words[1] ? ' ' + words[1].substring(0, 3) + '...' : '');
                            }
                            return subject.substring(0, 12) + '...';
                        }
                        return subject;
                    }),
                    datasets: [{
                        label: 'Jumlah Pembelajaran',
                        data: sortedSubjects.map(([,count]) => count),
                        backgroundColor: colors,
                        borderColor: borderColors,
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return sortedSubjects[context[0].dataIndex][0];
                                },
                                label: function(context) {
                                    const total = sortedSubjects.reduce((sum, [,count]) => sum + count, 0);
                                    const percentage = total > 0 ? ((context.parsed.y / total) * 100).toFixed(1) : 0;
                                    return `Pembelajaran: ${context.parsed.y} (${percentage}% dari total)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return value + ' kali';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Jumlah Pembelajaran'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 0,
                                font: {
                                    size: 10
                                }
                            },
                            title: {
                                display: true,
                                text: 'Mata Pelajaran'
                            }
                        }
                    }
                }
            });
        }

        // Daily trend chart
        function updateDailyTrendChart(data = journalData) {
            const ctx = document.getElementById('dailyTrendChart');
            if (!ctx) return;
            
            destroyChart('dailyTrendChart');
            
            // Separate data by attendance status
            const dailyAttendanceData = data.reduce((acc, row) => {
                const date = row['TANGGAL'];
                const status = row['KEHADIRAN GURU'];
                
                if (date && date !== '-') {
                    if (!acc[date]) {
                        acc[date] = { hadir: 0, tidakHadir: 0, total: 0 };
                    }
                    
                    acc[date].total += 1;
                    
                    if (status === 'Masuk Kelas' || status === 'Hadir') {
                        acc[date].hadir += 1;
                    } else if (status === 'Tidak Masuk Kelas' || status?.includes('Sakit') || status?.includes('Izin')) {
                        acc[date].tidakHadir += 1;
                    }
                }
                return acc;
            }, {});
            
            const sortedDates = Object.entries(dailyAttendanceData)
                .sort(([a], [b]) => {
                    const dateA = parseDate(a);
                    const dateB = parseDate(b);
                    return dateA - dateB;
                })
                .slice(-14); // Show last 14 days
            
            const labels = sortedDates.map(([date]) => {
                const parsedDate = parseDate(date);
                return parsedDate ? parsedDate.toLocaleDateString('id-ID', { 
                    day: '2-digit', 
                    month: 'short' 
                }) : date;
            });
            
            chartInstances['dailyTrendChart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Guru Hadir',
                            data: sortedDates.map(([,data]) => data.hadir),
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: '#10B981',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        },
                        {
                            label: 'Guru Tidak Hadir',
                            data: sortedDates.map(([,data]) => data.tidakHadir),
                            borderColor: '#EF4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: '#EF4444',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        },
                        {
                            label: 'Total Pembelajaran',
                            data: sortedDates.map(([,data]) => data.total),
                            borderColor: '#667EEA',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#667EEA',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                title: function(context) {
                                    const originalDate = sortedDates[context[0].dataIndex][0];
                                    const parsedDate = parseDate(originalDate);
                                    return parsedDate ? parsedDate.toLocaleDateString('id-ID', { 
                                        weekday: 'long',
                                        day: 'numeric', 
                                        month: 'long',
                                        year: 'numeric'
                                    }) : originalDate;
                                },
                                afterBody: function(context) {
                                    const dateData = sortedDates[context[0].dataIndex][1];
                                    const attendanceRate = dateData.total > 0 ? 
                                        ((dateData.hadir / dateData.total) * 100).toFixed(1) : 0;
                                    return `Tingkat Kehadiran: ${attendanceRate}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return value + ' guru';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Jumlah Guru'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 0,
                                font: {
                                    size: 10
                                }
                            },
                            title: {
                                display: true,
                                text: 'Tanggal'
                            }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    }
                }
            });
        }

        // Top teachers chart with detailed analysis
        function updateTopTeachersChart(data = journalData) {
            const ctx = document.getElementById('topTeachersChart');
            if (!ctx) return;
            
            destroyChart('topTeachersChart');
            
            // Analyze teacher performance with attendance details
            const teacherAnalysis = data.reduce((acc, row) => {
                const teacher = row['NAMA GURU'];
                const status = row['KEHADIRAN GURU'];
                
                if (teacher && teacher.trim() !== '' && teacher !== '-') {
                    if (!acc[teacher]) {
                        acc[teacher] = { 
                            total: 0, 
                            hadir: 0, 
                            tidakHadir: 0,
                            subjects: new Set(),
                            attendanceRate: 0
                        };
                    }
                    
                    acc[teacher].total += 1;
                    acc[teacher].subjects.add(row['MAPEL'] || 'Tidak Diketahui');
                    
                    if (status === 'Masuk Kelas' || status === 'Hadir') {
                        acc[teacher].hadir += 1;
                    } else if (status === 'Tidak Masuk Kelas' || status?.includes('Sakit') || status?.includes('Izin')) {
                        acc[teacher].tidakHadir += 1;
                    }
                    
                    // Calculate attendance rate
                    acc[teacher].attendanceRate = acc[teacher].total > 0 ? 
                        (acc[teacher].hadir / acc[teacher].total) * 100 : 0;
                }
                return acc;
            }, {});
            
            // Sort by total teaching sessions, then by attendance rate
            const sortedTeachers = Object.entries(teacherAnalysis)
                .sort(([,a], [,b]) => {
                    if (b.total === a.total) {
                        return b.attendanceRate - a.attendanceRate;
                    }
                    return b.total - a.total;
                })
                .slice(0, 10);
            
            // Generate colors based on attendance rate
            const colors = sortedTeachers.map(([,data]) => {
                const rate = data.attendanceRate;
                if (rate >= 90) return 'rgba(16, 185, 129, 0.8)'; // Green for excellent
                if (rate >= 75) return 'rgba(59, 130, 246, 0.8)'; // Blue for good
                if (rate >= 60) return 'rgba(245, 158, 11, 0.8)'; // Yellow for fair
                return 'rgba(239, 68, 68, 0.8)'; // Red for poor
            });
            
            const borderColors = sortedTeachers.map(([,data]) => {
                const rate = data.attendanceRate;
                if (rate >= 90) return 'rgba(16, 185, 129, 1)';
                if (rate >= 75) return 'rgba(59, 130, 246, 1)';
                if (rate >= 60) return 'rgba(245, 158, 11, 1)';
                return 'rgba(239, 68, 68, 1)';
            });
            
            chartInstances['topTeachersChart'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedTeachers.map(([teacher]) => {
                        // Smart name truncation
                        if (teacher.length > 15) {
                            const parts = teacher.split(' ');
                            if (parts.length > 1) {
                                return parts[0] + ' ' + parts[parts.length - 1].substring(0, 8) + '...';
                            }
                            return teacher.substring(0, 15) + '...';
                        }
                        return teacher;
                    }),
                    datasets: [{
                        label: 'Total Mengajar',
                        data: sortedTeachers.map(([,data]) => data.total),
                        backgroundColor: colors,
                        borderColor: borderColors,
                        borderWidth: 2,
                        borderRadius: 6,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return sortedTeachers[context[0].dataIndex][0];
                                },
                                label: function(context) {
                                    const teacherData = sortedTeachers[context[0].dataIndex][1];
                                    return [
                                        `Total Mengajar: ${teacherData.total} kali`,
                                        `Hadir: ${teacherData.hadir} kali`,
                                        `Tidak Hadir: ${teacherData.tidakHadir} kali`,
                                        `Tingkat Kehadiran: ${teacherData.attendanceRate.toFixed(1)}%`,
                                        `Mata Pelajaran: ${teacherData.subjects.size} mapel`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return value + ' kali';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Jumlah Mengajar'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 0,
                                font: {
                                    size: 10
                                }
                            },
                            title: {
                                display: true,
                                text: 'Nama Guru'
                            }
                        }
                    }
                }
            });
        }

        // Update reports with filters
        function updateReports() {
            const period = document.getElementById('report-period-filter')?.value || '30';
            const teacherFilter = document.getElementById('teacher-filter-reports')?.value || '';
            const subjectFilter = document.getElementById('subject-filter-reports')?.value || '';
            const reportType = document.getElementById('report-type-filter')?.value || 'overview';
            
            // Filter data based on report filters
            let reportData = [...journalData];
            
            // Apply period filter
            if (period !== 'all') {
                const days = parseInt(period);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                
                reportData = reportData.filter(row => {
                    const rowDate = parseDate(row['TANGGAL']);
                    return rowDate && rowDate >= cutoffDate;
                });
            }
            
            // Apply teacher filter
            if (teacherFilter) {
                reportData = reportData.filter(row => row['NAMA GURU'] === teacherFilter);
            }
            
            // Apply subject filter
            if (subjectFilter) {
                reportData = reportData.filter(row => row['MAPEL'] === subjectFilter);
            }
            
            updateReportSummary(reportData);
            updateReportCharts(reportData);
            updateReportTables(reportData);
            updateReportInsights(reportData);
            updateReportRecommendations(reportData);
        }

        // Update report summary cards
        function updateReportSummary(data) {
            const stats = data.reduce((acc, row) => {
                acc.hadir += parseInt(row['HADIR'] || 0);
                acc.alpa += parseInt(row['ALPA'] || 0);
                acc.izin += parseInt(row['IZIN'] || 0);
                acc.sakit += parseInt(row['SAKIT'] || 0);
                return acc;
            }, { hadir: 0, alpa: 0, izin: 0, sakit: 0 });

            const total = stats.hadir + stats.alpa + stats.izin + stats.sakit;

            // Update summary cards with percentages
            const summaryElements = {
                'total-hadir-report': { value: stats.hadir, percentage: 'hadir-percentage' },
                'total-alpa-report': { value: stats.alpa, percentage: 'alpa-percentage' },
                'total-izin-report': { value: stats.izin, percentage: 'izin-percentage' },
                'total-sakit-report': { value: stats.sakit, percentage: 'sakit-percentage' }
            };

            Object.entries(summaryElements).forEach(([id, data]) => {
                const element = document.getElementById(id);
                const percentageElement = document.getElementById(data.percentage);
                
                if (element) element.textContent = data.value.toLocaleString();
                if (percentageElement) {
                    const percentage = total > 0 ? ((data.value / total) * 100).toFixed(1) : 0;
                    percentageElement.textContent = percentage + '%';
                }
            });
        }

        // Update all report charts
        function updateReportCharts(data) {
            updateStudentAttendanceReportChart(data);
            updateTeacherPerformanceReportChart(data);
            updateWeeklyTrendReportChart(data);
            updateSubjectAnalysisReportChart(data);
        }

        // Student attendance report chart
        function updateStudentAttendanceReportChart(data = journalData) {
            const ctx = document.getElementById('studentAttendanceReportChart');
            if (!ctx) return;
            
            destroyChart('studentAttendanceReportChart');
            
            const attendanceStats = data.reduce((acc, row) => {
                acc.hadir += parseInt(row['HADIR'] || 0);
                acc.alpa += parseInt(row['ALPA'] || 0);
                acc.izin += parseInt(row['IZIN'] || 0);
                acc.sakit += parseInt(row['SAKIT'] || 0);
                return acc;
            }, { hadir: 0, alpa: 0, izin: 0, sakit: 0 });
            
            const total = attendanceStats.hadir + attendanceStats.alpa + attendanceStats.izin + attendanceStats.sakit;
            
            chartInstances['studentAttendanceReportChart'] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Hadir', 'Alpa', 'Izin', 'Sakit'],
                    datasets: [{
                        data: [attendanceStats.hadir, attendanceStats.alpa, attendanceStats.izin, attendanceStats.sakit],
                        backgroundColor: ['#10B981', '#EF4444', '#F59E0B', '#8B5CF6'],
                        borderWidth: 3,
                        borderColor: '#ffffff',
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 11
                                },
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    return data.labels.map((label, i) => {
                                        const value = data.datasets[0].data[i];
                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                        return {
                                            text: `${label}: ${value} (${percentage}%)`,
                                            fillStyle: data.datasets[0].backgroundColor[i],
                                            strokeStyle: data.datasets[0].backgroundColor[i],
                                            pointStyle: 'circle'
                                        };
                                    });
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const percentage = total > 0 ? ((context.parsed / total) * 100).toFixed(1) : 0;
                                    return `${context.label}: ${context.parsed} siswa (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Update summary
            const summaryElement = document.getElementById('student-attendance-summary');
            if (summaryElement) {
                const attendanceRate = total > 0 ? ((attendanceStats.hadir / total) * 100).toFixed(1) : 0;
                summaryElement.innerHTML = `
                    <div class="grid grid-cols-2 gap-4 text-xs">
                        <div><strong>Total Kehadiran:</strong> ${total.toLocaleString()} siswa</div>
                        <div><strong>Tingkat Kehadiran:</strong> ${attendanceRate}%</div>
                        <div><strong>Siswa Bermasalah:</strong> ${(attendanceStats.alpa + attendanceStats.izin).toLocaleString()}</div>
                        <div><strong>Periode:</strong> ${document.getElementById('report-period-filter')?.value || '30'} hari</div>
                    </div>
                `;
            }
        }

        // Teacher performance report chart
        function updateTeacherPerformanceReportChart(data = journalData) {
            const ctx = document.getElementById('teacherPerformanceReportChart');
            if (!ctx) return;
            
            destroyChart('teacherPerformanceReportChart');
            
            // Analyze teacher performance
            const teacherPerformance = data.reduce((acc, row) => {
                const teacher = row['NAMA GURU'];
                const status = row['KEHADIRAN GURU'];
                
                if (teacher && teacher.trim() !== '' && teacher !== '-') {
                    if (!acc[teacher]) {
                        acc[teacher] = { total: 0, hadir: 0, tidakHadir: 0 };
                    }
                    
                    acc[teacher].total += 1;
                    
                    if (status === 'Masuk Kelas' || status === 'Hadir') {
                        acc[teacher].hadir += 1;
                    } else {
                        acc[teacher].tidakHadir += 1;
                    }
                }
                return acc;
            }, {});
            
            // Calculate attendance rates and sort
            const teacherRates = Object.entries(teacherPerformance)
                .map(([teacher, data]) => ({
                    teacher,
                    rate: data.total > 0 ? (data.hadir / data.total) * 100 : 0,
                    total: data.total,
                    hadir: data.hadir,
                    tidakHadir: data.tidakHadir
                }))
                .sort((a, b) => b.rate - a.rate)
                .slice(0, 10);
            
            // Generate colors based on performance
            const colors = teacherRates.map(item => {
                if (item.rate >= 95) return 'rgba(16, 185, 129, 0.8)'; // Excellent - Green
                if (item.rate >= 85) return 'rgba(59, 130, 246, 0.8)'; // Good - Blue
                if (item.rate >= 70) return 'rgba(245, 158, 11, 0.8)'; // Fair - Yellow
                return 'rgba(239, 68, 68, 0.8)'; // Poor - Red
            });
            
            chartInstances['teacherPerformanceReportChart'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: teacherRates.map(item => {
                        const name = item.teacher;
                        return name.length > 12 ? name.substring(0, 12) + '...' : name;
                    }),
                    datasets: [{
                        label: 'Tingkat Kehadiran (%)',
                        data: teacherRates.map(item => item.rate),
                        backgroundColor: colors,
                        borderColor: colors.map(color => color.replace('0.8', '1')),
                        borderWidth: 2,
                        borderRadius: 6,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return teacherRates[context[0].dataIndex].teacher;
                                },
                                label: function(context) {
                                    const data = teacherRates[context[0].dataIndex];
                                    return [
                                        `Tingkat Kehadiran: ${data.rate.toFixed(1)}%`,
                                        `Total Mengajar: ${data.total} kali`,
                                        `Hadir: ${data.hadir} kali`,
                                        `Tidak Hadir: ${data.tidakHadir} kali`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Tingkat Kehadiran (%)'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 0,
                                font: {
                                    size: 10
                                }
                            },
                            title: {
                                display: true,
                                text: 'Nama Guru'
                            }
                        }
                    }
                }
            });

            // Update summary
            const summaryElement = document.getElementById('teacher-performance-summary');
            if (summaryElement) {
                const avgRate = teacherRates.length > 0 ? 
                    teacherRates.reduce((sum, item) => sum + item.rate, 0) / teacherRates.length : 0;
                const excellentTeachers = teacherRates.filter(item => item.rate >= 95).length;
                
                summaryElement.innerHTML = `
                    <div class="grid grid-cols-2 gap-4 text-xs">
                        <div><strong>Rata-rata Kehadiran:</strong> ${avgRate.toFixed(1)}%</div>
                        <div><strong>Guru Excellent (â‰¥95%):</strong> ${excellentTeachers}</div>
                        <div><strong>Total Guru Aktif:</strong> ${teacherRates.length}</div>
                        <div><strong>Guru Terbaik:</strong> ${teacherRates[0]?.teacher || 'Tidak ada'}</div>
                    </div>
                `;
            }
        }

        // Weekly trend report chart
        function updateWeeklyTrendReportChart(data = journalData) {
            const ctx = document.getElementById('weeklyTrendReportChart');
            if (!ctx) return;
            
            destroyChart('weeklyTrendReportChart');
            
            const dayNames = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];
            
            // Analyze both teacher and student attendance by day
            const weeklyData = data.reduce((acc, row) => {
                const dayName = row['HARI'];
                if (dayName && dayNames.includes(dayName)) {
                    if (!acc[dayName]) {
                        acc[dayName] = {
                            teacherPresent: 0,
                            teacherAbsent: 0,
                            studentPresent: 0,
                            studentAbsent: 0
                        };
                    }
                    
                    // Teacher attendance
                    const teacherStatus = row['KEHADIRAN GURU'];
                    if (teacherStatus === 'Masuk Kelas' || teacherStatus === 'Hadir') {
                        acc[dayName].teacherPresent += 1;
                    } else {
                        acc[dayName].teacherAbsent += 1;
                    }
                    
                    // Student attendance
                    acc[dayName].studentPresent += parseInt(row['HADIR'] || 0);
                    acc[dayName].studentAbsent += parseInt(row['ALPA'] || 0) + parseInt(row['IZIN'] || 0) + parseInt(row['SAKIT'] || 0);
                }
                return acc;
            }, {});
            
            chartInstances['weeklyTrendReportChart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dayNames,
                    datasets: [
                        {
                            label: 'Guru Hadir',
                            data: dayNames.map(day => weeklyData[day]?.teacherPresent || 0),
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: '#10B981',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Siswa Hadir (Rata-rata)',
                            data: dayNames.map(day => {
                                const dayData = weeklyData[day];
                                if (!dayData) return 0;
                                const totalSessions = dayData.teacherPresent + dayData.teacherAbsent;
                                return totalSessions > 0 ? Math.round(dayData.studentPresent / totalSessions) : 0;
                            }),
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#3B82F6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                title: function(context) {
                                    return `Hari ${context[0].label}`;
                                },
                                afterBody: function(context) {
                                    const day = dayNames[context[0].dataIndex];
                                    const dayData = weeklyData[day];
                                    if (dayData) {
                                        const teacherTotal = dayData.teacherPresent + dayData.teacherAbsent;
                                        const teacherRate = teacherTotal > 0 ? 
                                            ((dayData.teacherPresent / teacherTotal) * 100).toFixed(1) : 0;
                                        return `Tingkat Kehadiran Guru: ${teacherRate}%`;
                                    }
                                    return '';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return value + ' guru';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Jumlah Guru'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            ticks: {
                                stepSize: 5,
                                callback: function(value) {
                                    return value + ' siswa';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Rata-rata Siswa Hadir'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Hari dalam Seminggu'
                            }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    }
                }
            });

            // Update summary
            const summaryElement = document.getElementById('weekly-trend-summary');
            if (summaryElement) {
                const bestDay = dayNames.reduce((best, day) => {
                    const dayData = weeklyData[day];
                    const bestData = weeklyData[best];
                    if (!dayData) return best;
                    if (!bestData) return day;
                    return dayData.teacherPresent > bestData.teacherPresent ? day : best;
                }, dayNames[0]);
                
                const worstDay = dayNames.reduce((worst, day) => {
                    const dayData = weeklyData[day];
                    const worstData = weeklyData[worst];
                    if (!dayData) return worst;
                    if (!worstData) return day;
                    return dayData.teacherPresent < worstData.teacherPresent ? day : worst;
                }, dayNames[0]);
                
                summaryElement.innerHTML = `
                    <div class="grid grid-cols-2 gap-4 text-xs">
                        <div><strong>Hari Terbaik:</strong> ${bestDay}</div>
                        <div><strong>Hari Terburuk:</strong> ${worstDay}</div>
                        <div><strong>Total Hari Aktif:</strong> ${dayNames.filter(day => weeklyData[day]?.teacherPresent > 0).length}</div>
                        <div><strong>Pola Tren:</strong> ${bestDay === 'Senin' ? 'Awal minggu kuat' : bestDay === 'Jumat' ? 'Akhir minggu kuat' : 'Tengah minggu optimal'}</div>
                    </div>
                `;
            }
        }

        // Subject analysis report chart
        function updateSubjectAnalysisReportChart(data = journalData) {
            const ctx = document.getElementById('subjectAnalysisReportChart');
            if (!ctx) return;
            
            destroyChart('subjectAnalysisReportChart');
            
            // Analyze subject performance
            const subjectAnalysis = data.reduce((acc, row) => {
                const subject = row['MAPEL'];
                if (subject && subject.trim() !== '' && subject !== '-') {
                    if (!acc[subject]) {
                        acc[subject] = {
                            frequency: 0,
                            teacherPresent: 0,
                            studentTotal: 0,
                            studentPresent: 0
                        };
                    }
                    
                    acc[subject].frequency += 1;
                    
                    if (row['KEHADIRAN GURU'] === 'Masuk Kelas' || row['KEHADIRAN GURU'] === 'Hadir') {
                        acc[subject].teacherPresent += 1;
                    }
                    
                    const hadir = parseInt(row['HADIR'] || 0);
                    const alpa = parseInt(row['ALPA'] || 0);
                    const izin = parseInt(row['IZIN'] || 0);
                    const sakit = parseInt(row['SAKIT'] || 0);
                    
                    acc[subject].studentPresent += hadir;
                    acc[subject].studentTotal += hadir + alpa + izin + sakit;
                }
                return acc;
            }, {});
            
            // Calculate rates and sort by frequency
            const subjectData = Object.entries(subjectAnalysis)
                .map(([subject, data]) => ({
                    subject,
                    frequency: data.frequency,
                    teacherRate: data.frequency > 0 ? (data.teacherPresent / data.frequency) * 100 : 0,
                    studentRate: data.studentTotal > 0 ? (data.studentPresent / data.studentTotal) * 100 : 0,
                    avgStudents: data.frequency > 0 ? Math.round(data.studentTotal / data.frequency) : 0
                }))
                .sort((a, b) => b.frequency - a.frequency)
                .slice(0, 8);
            
            // Generate colors based on overall performance
            const colors = subjectData.map(item => {
                const overallScore = (item.teacherRate + item.studentRate) / 2;
                if (overallScore >= 90) return 'rgba(16, 185, 129, 0.8)'; // Excellent
                if (overallScore >= 80) return 'rgba(59, 130, 246, 0.8)'; // Good
                if (overallScore >= 70) return 'rgba(245, 158, 11, 0.8)'; // Fair
                return 'rgba(239, 68, 68, 0.8)'; // Needs attention
            });
            
            chartInstances['subjectAnalysisReportChart'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: subjectData.map(item => {
                        const name = item.subject;
                        return name.length > 10 ? name.substring(0, 10) + '...' : name;
                    }),
                    datasets: [{
                        label: 'Frekuensi Pembelajaran',
                        data: subjectData.map(item => item.frequency),
                        backgroundColor: colors,
                        borderColor: colors.map(color => color.replace('0.8', '1')),
                        borderWidth: 2,
                        borderRadius: 6,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return subjectData[context[0].dataIndex].subject;
                                },
                                label: function(context) {
                                    const data = subjectData[context[0].dataIndex];
                                    return [
                                        `Frekuensi: ${data.frequency} kali`,
                                        `Kehadiran Guru: ${data.teacherRate.toFixed(1)}%`,
                                        `Kehadiran Siswa: ${data.studentRate.toFixed(1)}%`,
                                        `Rata-rata Siswa: ${data.avgStudents} orang`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return value + ' kali';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Frekuensi Pembelajaran'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 0,
                                font: {
                                    size: 10
                                }
                            },
                            title: {
                                display: true,
                                text: 'Mata Pelajaran'
                            }
                        }
                    }
                }
            });

            // Update summary
            const summaryElement = document.getElementById('subject-analysis-summary');
            if (summaryElement) {
                const topSubject = subjectData[0];
                const avgFreq = subjectData.length > 0 ? 
                    subjectData.reduce((sum, item) => sum + item.frequency, 0) / subjectData.length : 0;
                
                summaryElement.innerHTML = `
                    <div class="grid grid-cols-2 gap-4 text-xs">
                        <div><strong>Mapel Terpopuler:</strong> ${topSubject?.subject || 'Tidak ada'}</div>
                        <div><strong>Rata-rata Frekuensi:</strong> ${avgFreq.toFixed(1)} kali</div>
                        <div><strong>Total Mapel Aktif:</strong> ${subjectData.length}</div>
                        <div><strong>Variasi Pembelajaran:</strong> ${subjectData.length >= 8 ? 'Sangat Beragam' : subjectData.length >= 5 ? 'Beragam' : 'Terbatas'}</div>
                    </div>
                `;
            }
        }

        // Update report tables
        function updateReportTables(data) {
            updateTopTeachersTable(data);
            updateSubjectPerformanceTable(data);
        }

        // Update top teachers table
        function updateTopTeachersTable(data) {
            const tbody = document.getElementById('top-teachers-table');
            if (!tbody) return;

            // Analyze teacher performance
            const teacherPerformance = data.reduce((acc, row) => {
                const teacher = row['NAMA GURU'];
                const status = row['KEHADIRAN GURU'];
                
                if (teacher && teacher.trim() !== '' && teacher !== '-') {
                    if (!acc[teacher]) {
                        acc[teacher] = { total: 0, hadir: 0 };
                    }
                    
                    acc[teacher].total += 1;
                    
                    if (status === 'Masuk Kelas' || status === 'Hadir') {
                        acc[teacher].hadir += 1;
                    }
                }
                return acc;
            }, {});

            // Calculate rates and sort
            const topTeachers = Object.entries(teacherPerformance)
                .map(([teacher, data]) => ({
                    teacher,
                    rate: data.total > 0 ? (data.hadir / data.total) * 100 : 0,
                    total: data.total,
                    hadir: data.hadir
                }))
                .sort((a, b) => b.rate - a.rate)
                .slice(0, 10);

            tbody.innerHTML = topTeachers.map((item, index) => {
                const badgeClass = item.rate >= 95 ? 'bg-green-100 text-green-800' :
                                 item.rate >= 85 ? 'bg-blue-100 text-blue-800' :
                                 item.rate >= 70 ? 'bg-yellow-100 text-yellow-800' :
                                 'bg-red-100 text-red-800';
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 text-center">
                            <span class="inline-flex items-center justify-center w-8 h-8 rounded-full ${index < 3 ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-600'} font-bold text-sm">
                                ${index + 1}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm font-medium text-gray-900">${item.teacher}</td>
                        <td class="px-4 py-3 text-center">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${badgeClass}">
                                ${item.rate.toFixed(1)}%
                            </span>
                        </td>
                        <td class="px-4 py-3 text-center text-sm text-gray-900">${item.total} kali</td>
                    </tr>
                `;
            }).join('');
        }

        // Update subject performance table
        function updateSubjectPerformanceTable(data) {
            const tbody = document.getElementById('subject-performance-table');
            if (!tbody) return;

            // Analyze subject performance
            const subjectAnalysis = data.reduce((acc, row) => {
                const subject = row['MAPEL'];
                if (subject && subject.trim() !== '' && subject !== '-') {
                    if (!acc[subject]) {
                        acc[subject] = {
                            frequency: 0,
                            teacherPresent: 0,
                            studentTotal: 0,
                            studentPresent: 0
                        };
                    }
                    
                    acc[subject].frequency += 1;
                    
                    if (row['KEHADIRAN GURU'] === 'Masuk Kelas' || row['KEHADIRAN GURU'] === 'Hadir') {
                        acc[subject].teacherPresent += 1;
                    }
                    
                    const hadir = parseInt(row['HADIR'] || 0);
                    const alpa = parseInt(row['ALPA'] || 0);
                    const izin = parseInt(row['IZIN'] || 0);
                    const sakit = parseInt(row['SAKIT'] || 0);
                    
                    acc[subject].studentPresent += hadir;
                    acc[subject].studentTotal += hadir + alpa + izin + sakit;
                }
                return acc;
            }, {});

            // Calculate rates and sort
            const subjectData = Object.entries(subjectAnalysis)
                .map(([subject, data]) => ({
                    subject,
                    frequency: data.frequency,
                    teacherRate: data.frequency > 0 ? (data.teacherPresent / data.frequency) * 100 : 0,
                    studentRate: data.studentTotal > 0 ? (data.studentPresent / data.studentTotal) * 100 : 0,
                    avgStudents: data.frequency > 0 ? Math.round(data.studentTotal / data.frequency) : 0
                }))
                .sort((a, b) => b.frequency - a.frequency)
                .slice(0, 10);

            tbody.innerHTML = subjectData.map(item => {
                const teacherBadgeClass = item.teacherRate >= 90 ? 'bg-green-100 text-green-800' :
                                        item.teacherRate >= 80 ? 'bg-blue-100 text-blue-800' :
                                        item.teacherRate >= 70 ? 'bg-yellow-100 text-yellow-800' :
                                        'bg-red-100 text-red-800';
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm font-medium text-gray-900" title="${item.subject}">
                            ${item.subject.length > 20 ? item.subject.substring(0, 20) + '...' : item.subject}
                        </td>
                        <td class="px-4 py-3 text-center text-sm text-gray-900">${item.frequency} kali</td>
                        <td class="px-4 py-3 text-center">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${teacherBadgeClass}">
                                ${item.teacherRate.toFixed(1)}%
                            </span>
                        </td>
                        <td class="px-4 py-3 text-center text-sm text-gray-900">${item.avgStudents} siswa</td>
                    </tr>
                `;
            }).join('');
        }

        // Update report insights
        function updateReportInsights(data) {
            const container = document.getElementById('report-insights');
            if (!container) return;
            
            const insights = [];
            
            // Student attendance analysis
            const studentStats = data.reduce((acc, row) => {
                acc.hadir += parseInt(row['HADIR'] || 0);
                acc.alpa += parseInt(row['ALPA'] || 0);
                acc.izin += parseInt(row['IZIN'] || 0);
                acc.sakit += parseInt(row['SAKIT'] || 0);
                return acc;
            }, { hadir: 0, alpa: 0, izin: 0, sakit: 0 });
            
            const totalStudents = studentStats.hadir + studentStats.alpa + studentStats.izin + studentStats.sakit;
            const studentAttendanceRate = totalStudents > 0 ? (studentStats.hadir / totalStudents) * 100 : 0;
            
            if (studentAttendanceRate >= 90) {
                insights.push({
                    type: 'success',
                    icon: 'ğŸ‰',
                    title: 'Kehadiran Siswa Excellent',
                    description: `Tingkat kehadiran siswa mencapai ${studentAttendanceRate.toFixed(1)}%, menunjukkan engagement yang luar biasa.`
                });
            } else if (studentAttendanceRate >= 80) {
                insights.push({
                    type: 'good',
                    icon: 'ğŸ‘',
                    title: 'Kehadiran Siswa Baik',
                    description: `Kehadiran siswa ${studentAttendanceRate.toFixed(1)}% sudah baik, namun masih ada ruang untuk peningkatan.`
                });
            } else {
                insights.push({
                    type: 'warning',
                    icon: 'âš ï¸',
                    title: 'Kehadiran Siswa Perlu Perhatian',
                    description: `Kehadiran siswa ${studentAttendanceRate.toFixed(1)}% masih di bawah standar ideal. Perlu intervensi segera.`
                });
            }
            
            // Teacher performance analysis
            const teacherData = data.reduce((acc, row) => {
                const teacher = row['NAMA GURU'];
                const status = row['KEHADIRAN GURU'];
                
                if (teacher && teacher.trim() !== '' && teacher !== '-') {
                    if (!acc[teacher]) acc[teacher] = { total: 0, hadir: 0 };
                    acc[teacher].total += 1;
                    if (status === 'Masuk Kelas' || status === 'Hadir') {
                        acc[teacher].hadir += 1;
                    }
                }
                return acc;
            }, {});
            
            const teacherRates = Object.values(teacherData).map(data => 
                data.total > 0 ? (data.hadir / data.total) * 100 : 0
            );
            const avgTeacherRate = teacherRates.length > 0 ? 
                teacherRates.reduce((sum, rate) => sum + rate, 0) / teacherRates.length : 0;
            
            insights.push({
                type: avgTeacherRate >= 85 ? 'success' : avgTeacherRate >= 75 ? 'good' : 'warning',
                icon: 'ğŸ‘¨â€ğŸ«',
                title: 'Kinerja Guru',
                description: `Rata-rata kehadiran guru ${avgTeacherRate.toFixed(1)}%. ${Object.keys(teacherData).length} guru aktif dalam periode ini.`
            });
            
            // Subject diversity analysis
            const subjectCount = new Set(data.map(row => row['MAPEL']).filter(s => s && s !== '-')).size;
            insights.push({
                type: 'info',
                icon: 'ğŸ“š',
                title: 'Diversitas Pembelajaran',
                description: `Terdapat ${subjectCount} mata pelajaran yang diajarkan, menunjukkan ${subjectCount >= 10 ? 'variasi yang sangat baik' : subjectCount >= 6 ? 'variasi yang cukup' : 'variasi yang terbatas'}.`
            });
            
            // Render insights
            container.innerHTML = insights.map(insight => `
                <div class="p-4 rounded-xl border-l-4 ${getInsightStyle(insight.type)}">
                    <div class="flex items-start space-x-3">
                        <span class="text-2xl">${insight.icon}</span>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900 mb-1">${insight.title}</h4>
                            <p class="text-sm text-gray-600">${insight.description}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Update report recommendations
        function updateReportRecommendations(data) {
            const container = document.getElementById('report-recommendations');
            if (!container) return;
            
            const recommendations = [];
            
            // Analyze student attendance issues
            const studentStats = data.reduce((acc, row) => {
                acc.hadir += parseInt(row['HADIR'] || 0);
                acc.alpa += parseInt(row['ALPA'] || 0);
                acc.izin += parseInt(row['IZIN'] || 0);
                acc.sakit += parseInt(row['SAKIT'] || 0);
                return acc;
            }, { hadir: 0, alpa: 0, izin: 0, sakit: 0 });
            
            const totalStudents = studentStats.hadir + studentStats.alpa + studentStats.izin + studentStats.sakit;
            const alpaRate = totalStudents > 0 ? (studentStats.alpa / totalStudents) * 100 : 0;
            
            if (alpaRate > 10) {
                recommendations.push({
                    priority: 'high',
                    icon: 'ğŸš¨',
                    title: 'Tangani Masalah Ketidakhadiran',
                    description: `Tingkat alpa siswa ${alpaRate.toFixed(1)}% terlalu tinggi. Perlu tindakan segera untuk mengurangi absensi tanpa keterangan.`,
                    action: 'Implementasi sistem follow-up untuk siswa yang sering alpa'
                });
            }
            
            // Analyze teacher consistency
            const teacherData = data.reduce((acc, row) => {
                const teacher = row['NAMA GURU'];
                if (teacher && teacher.trim() !== '' && teacher !== '-') {
                    if (!acc[teacher]) acc[teacher] = { total: 0, hadir: 0 };
                    acc[teacher].total += 1;
                    if (row['KEHADIRAN GURU'] === 'Masuk Kelas' || row['KEHADIRAN GURU'] === 'Hadir') {
                        acc[teacher].hadir += 1;
                    }
                }
                return acc;
            }, {});
            
            const inconsistentTeachers = Object.entries(teacherData)
                .filter(([, data]) => {
                    const rate = data.total > 0 ? (data.hadir / data.total) * 100 : 0;
                    return rate < 80;
                }).length;
            
            if (inconsistentTeachers > 0) {
                recommendations.push({
                    priority: 'medium',
                    icon: 'ğŸ“‹',
                    title: 'Tingkatkan Konsistensi Guru',
                    description: `${inconsistentTeachers} guru memiliki tingkat kehadiran di bawah 80%. Perlu pembinaan dan monitoring.`,
                    action: 'Lakukan coaching dan evaluasi kinerja guru'
                });
            }
            
            // Analyze subject balance
            const subjectFreq = data.reduce((acc, row) => {
                const subject = row['MAPEL'];
                if (subject && subject !== '-') {
                    acc[subject] = (acc[subject] || 0) + 1;
                }
                return acc;
            }, {});
            
            const subjectCounts = Object.values(subjectFreq);
            const maxFreq = Math.max(...subjectCounts);
            const minFreq = Math.min(...subjectCounts);
            
            if (maxFreq > minFreq * 3) {
                recommendations.push({
                    priority: 'medium',
                    icon: 'âš–ï¸',
                    title: 'Seimbangkan Distribusi Mata Pelajaran',
                    description: 'Terdapat ketimpangan frekuensi pembelajaran antar mata pelajaran. Beberapa mapel kurang mendapat perhatian.',
                    action: 'Review dan redistribusi jadwal pembelajaran'
                });
            }
            
            // Weekly pattern analysis
            const weeklyData = data.reduce((acc, row) => {
                const day = row['HARI'];
                if (day) {
                    acc[day] = (acc[day] || 0) + 1;
                }
                return acc;
            }, {});
            
            const weekdayCounts = Object.values(weeklyData);
            const avgDaily = weekdayCounts.length > 0 ? 
                weekdayCounts.reduce((sum, count) => sum + count, 0) / weekdayCounts.length : 0;
            
            if (avgDaily < 8) {
                recommendations.push({
                    priority: 'low',
                    icon: 'ğŸ“…',
                    title: 'Optimalkan Pemanfaatan Waktu',
                    description: `Rata-rata ${avgDaily.toFixed(1)} pembelajaran per hari. Masih ada potensi untuk meningkatkan efektivitas jadwal.`,
                    action: 'Evaluasi dan optimalisasi penjadwalan pembelajaran'
                });
            }
            
            // Add positive reinforcement if performance is good
            if (recommendations.length === 0) {
                recommendations.push({
                    priority: 'low',
                    icon: 'ğŸŒŸ',
                    title: 'Pertahankan Kinerja Excellent',
                    description: 'Sistem pembelajaran berjalan dengan sangat baik. Semua indikator menunjukkan performa yang optimal.',
                    action: 'Lanjutkan praktik terbaik dan lakukan evaluasi berkala'
                });
            }
            
            // Render recommendations
            container.innerHTML = recommendations.map(rec => `
                <div class="p-4 rounded-xl border-l-4 ${getRecommendationStyle(rec.priority)}">
                    <div class="flex items-start space-x-3">
                        <span class="text-2xl">${rec.icon}</span>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-semibold text-gray-900">${rec.title}</h4>
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${getPriorityBadge(rec.priority)}">
                                    ${rec.priority.toUpperCase()}
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">${rec.description}</p>
                            <p class="text-xs text-gray-500 italic">ğŸ’¡ ${rec.action}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Reset report filters
        function resetReportFilters() {
            document.getElementById('report-period-filter').value = '30';
            document.getElementById('teacher-filter-reports').value = '';
            document.getElementById('subject-filter-reports').value = '';
            document.getElementById('report-type-filter').value = 'overview';
            updateReports();
        }

        // Generate full report
        function generateFullReport() {
            const reportData = getFilteredReportData();
            const reportWindow = window.open('', '_blank');
            
            const reportHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Laporan Pembelajaran - ${new Date().toLocaleDateString('id-ID')}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
                        .card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; text-align: center; }
                        .table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
                        .table th, .table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        .table th { background-color: #f5f5f5; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Laporan Pembelajaran</h1>
                        <p>Periode: ${document.getElementById('report-period-filter')?.value || '30'} hari</p>
                        <p>Tanggal Generate: ${new Date().toLocaleDateString('id-ID')}</p>
                    </div>
                    
                    <div class="summary">
                        <div class="card">
                            <h3>${document.getElementById('total-hadir-report')?.textContent || '0'}</h3>
                            <p>Total Siswa Hadir</p>
                        </div>
                        <div class="card">
                            <h3>${document.getElementById('total-alpa-report')?.textContent || '0'}</h3>
                            <p>Total Alpa</p>
                        </div>
                        <div class="card">
                            <h3>${document.getElementById('total-izin-report')?.textContent || '0'}</h3>
                            <p>Total Izin</p>
                        </div>
                        <div class="card">
                            <h3>${document.getElementById('total-sakit-report')?.textContent || '0'}</h3>
                            <p>Total Sakit</p>
                        </div>
                    </div>
                    
                    <h2>Detail Data Pembelajaran</h2>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Hari</th>
                                <th>Guru</th>
                                <th>Mata Pelajaran</th>
                                <th>Kehadiran Guru</th>
                                <th>Hadir</th>
                                <th>Alpa</th>
                                <th>Izin</th>
                                <th>Sakit</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${reportData.map(row => `
                                <tr>
                                    <td>${row['TANGGAL'] || '-'}</td>
                                    <td>${row['HARI'] || '-'}</td>
                                    <td>${row['NAMA GURU'] || '-'}</td>
                                    <td>${row['MAPEL'] || '-'}</td>
                                    <td>${row['KEHADIRAN GURU'] || '-'}</td>
                                    <td>${row['HADIR'] || '0'}</td>
                                    <td>${row['ALPA'] || '0'}</td>
                                    <td>${row['IZIN'] || '0'}</td>
                                    <td>${row['SAKIT'] || '0'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            reportWindow.document.write(reportHTML);
            reportWindow.document.close();
            
            showNotification('ğŸ“‹ Laporan berhasil di-generate!', 'success');
        }

        // Export report data
        function exportReportData() {
            const reportData = getFilteredReportData();
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Tanggal,Hari,Nama Guru,Mata Pelajaran,Kehadiran Guru,Hadir,Alpa,Izin,Sakit\n"
                + reportData.map(row => [
                    row['TANGGAL'] || '',
                    row['HARI'] || '',
                    row['NAMA GURU'] || '',
                    row['MAPEL'] || '',
                    row['KEHADIRAN GURU'] || '',
                    row['HADIR'] || '0',
                    row['ALPA'] || '0',
                    row['IZIN'] || '0',
                    row['SAKIT'] || '0'
                ].join(",")).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `laporan_pembelajaran_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('ğŸ“Š Laporan berhasil diekspor!', 'success');
        }

        // Print report
        function printReport() {
            window.print();
        }

        // Get filtered report data
        function getFilteredReportData() {
            const period = document.getElementById('report-period-filter')?.value || '30';
            const teacherFilter = document.getElementById('teacher-filter-reports')?.value || '';
            const subjectFilter = document.getElementById('subject-filter-reports')?.value || '';
            
            let reportData = [...journalData];
            
            // Apply period filter
            if (period !== 'all') {
                const days = parseInt(period);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                
                reportData = reportData.filter(row => {
                    const rowDate = parseDate(row['TANGGAL']);
                    return rowDate && rowDate >= cutoffDate;
                });
            }
            
            // Apply teacher filter
            if (teacherFilter) {
                reportData = reportData.filter(row => row['NAMA GURU'] === teacherFilter);
            }
            
            // Apply subject filter
            if (subjectFilter) {
                reportData = reportData.filter(row => row['MAPEL'] === subjectFilter);
            }
            
            return reportData;
        }

        // Show section
        function showSection(section) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + '-section').classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(link => {
                link.classList.remove('active');
                link.classList.remove('text-white');
                link.classList.add('text-white/80');
            });
            
            if (event?.target) {
                const navItem = event.target.closest('.nav-item');
                if (navItem) {
                    navItem.classList.add('active');
                    navItem.classList.add('text-white');
                    navItem.classList.remove('text-white/80');
                }
            }
            
            currentSection = section;
            
            // Update charts when switching to analytics or reports
            if (section === 'analytics' || section === 'reports') {
                setTimeout(updateAllCharts, 100);
            }
            
            // Update reports when switching to reports section
            if (section === 'reports') {
                setTimeout(() => {
                    populateFilters();
                    updateReports();
                }, 100);
            }
        }

        // Toggle mobile menu
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        }

        // Toggle dark mode
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            
            const themeIcon = document.getElementById('theme-icon');
            if (themeIcon) {
                themeIcon.innerHTML = isDarkMode 
                    ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>'
                    : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>';
            }
        }

        // Reset filters
        function resetFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('teacher-filter').value = '';
            document.getElementById('subject-filter').value = '';
            document.getElementById('date-from').value = '';
            document.getElementById('date-to').value = '';
            document.getElementById('entries-per-page').value = '25';
            entriesPerPage = 25;
            currentPage = 1;
            filterData();
        }

        // Update analytics with filters
        function updateAnalytics() {
            const period = document.getElementById('period-filter')?.value || '7';
            const teacherFilter = document.getElementById('teacher-filter-analytics')?.value || '';
            const subjectFilter = document.getElementById('subject-filter-analytics')?.value || '';
            
            // Filter data based on analytics filters
            let analyticsData = [...journalData];
            
            // Apply period filter
            if (period !== 'all') {
                const days = parseInt(period);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                
                analyticsData = analyticsData.filter(row => {
                    const rowDate = parseDate(row['TANGGAL']);
                    return rowDate && rowDate >= cutoffDate;
                });
            }
            
            // Apply teacher filter
            if (teacherFilter) {
                analyticsData = analyticsData.filter(row => row['NAMA GURU'] === teacherFilter);
            }
            
            // Apply subject filter
            if (subjectFilter) {
                analyticsData = analyticsData.filter(row => row['MAPEL'] === subjectFilter);
            }
            
            updateAnalyticsCharts(analyticsData);
        }

        // Reset analytics filters
        function resetAnalyticsFilters() {
            document.getElementById('period-filter').value = '7';
            document.getElementById('teacher-filter-analytics').value = '';
            document.getElementById('subject-filter-analytics').value = '';
            updateAnalytics();
        }

        // Export data
        function exportData() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + Object.keys(journalData[0] || {}).join(",") + "\n"
                + journalData.map(row => Object.values(row).join(",")).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "jurnal_data.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('ğŸ“Š Data berhasil diekspor!', 'success');
        }

        // Print data
        function printData() {
            window.print();
        }

        // Export chart
        function exportChart(chartId) {
            const chart = chartInstances[chartId];
            if (chart) {
                const url = chart.toBase64Image();
                const link = document.createElement('a');
                link.download = `${chartId}.png`;
                link.href = url;
                link.click();
                
                showNotification('ğŸ“ˆ Chart berhasil diekspor!', 'success');
            }
        }

        // Scroll to top
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99168e97622d3fa1',t:'MTc2MDk0Mjc3NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>